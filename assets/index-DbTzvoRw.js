import{f as C,r as p,j as s,co as w,cp as f,ai as R,T as S,v as T,B as y,D as b,A as j,x as A,b as k}from"./index-BTvwz0L3.js";import{Q as _}from"./questionnaires-BykLl9Mv.js";const B=({data:i,textareaPlaceholder:c,withStarsRating:m,handleSubmit:t})=>{const{t:h}=C(),{title:g,description:l}=i,[e,a]=p.useState({rate:0,note:""}),x=()=>{t(e.rate,e.note),a({rate:0,note:""})};return s.jsx("form",{onSubmit:x,children:m?s.jsx(w,{onSubmit:r=>a(o=>({...o,rate:r})),header:i.title,children:s.jsx(f,{placeholder:c,style:{marginTop:"30px"},value:e.note,onChange:({target:{value:r}})=>a(o=>({...o,note:r}))})}):s.jsxs(R,{$gap:30,children:[s.jsx(S.Title,{children:g}),s.jsx(T.Text,{children:l}),s.jsx(f,{placeholder:c,value:e.note,onChange:({target:{value:r}})=>a(o=>({...o,note:r}))}),s.jsx(y.Button,{type:"submit",mode:"primary",style:{width:"fit-content",alignSelf:"center"},children:e.note.length?h("RateCourse.SendAnswer"):h("RateCourse.NoAnswer")})]})})},M=({course:i,courseId:c,visible:m,questionnaire:t,onClose:h})=>{var o;const{sendQuestionnaireAnswer:g}=p.useContext(b.EscolaLMSContext),{t:l}=C(),[e,a]=p.useState({loading:!1,step:0,showLastScreen:!1}),x=p.useCallback(async(d,u)=>{if(t.questions){a(n=>({...n,loading:!0}));try{(await g(i,c,t.id,{question_id:t.questions[e.step].id,rate:d,note:u,visible_on_front:t.questions[e.step].public_answers})).success&&j.success(`${l("RateCourse.ThankYouMessage")}`)}catch(n){j.error("Error"),console.error(n)}finally{a(n=>({...n,loading:!1,step:n.step+1,note:"",rating:null}))}}},[i,c,t.id,e]),r=p.useCallback((d,u)=>{x(d,u),t.questions&&e.step===t.questions.length-1&&a(n=>({...n,showLastScreen:!0}))},[t,e.step,x]);return s.jsx(A.Modal,{onClose:h,visible:m,animation:"zoom",maskAnimation:"fade",destroyOnClose:!0,width:468,children:e.showLastScreen?s.jsxs(k.Fragment,{children:[s.jsx(S.Title,{level:4,className:"modal-title",style:{paddingTop:"50px"},children:l("RateCourse.ThankYou")}),s.jsx(T.Text,{style:{paddingBottom:"50px",textAlign:"center"},children:l("RateCourse.ThankYouMessage")})]}):t.questions&&s.jsx(B,{textareaPlaceholder:l("RateCourse.OptionalComment"),data:t.questions[e.step],handleSubmit:(d,u)=>r(d,u),withStarsRating:((o=t.questions[e.step])==null?void 0:o.type)===_.REVIEW})})};export{M as R};
