import{f as j,r as p,j as s,l,h as w,y as f,w as C,b as S,T as y,G as R}from"./index-DaafzRP_.js";import{Q as b}from"./questionnaires-DptVHaG1.js";const A=({data:c,textareaPlaceholder:d,withStarsRating:g,handleSubmit:t})=>{const{t:x}=j(),{title:T,description:i}=c,[e,a]=p.useState({rate:0,note:""}),m=()=>{t(e.rate,e.note),a({rate:0,note:""})};return s.jsx("form",{onSubmit:m,children:g?s.jsx(l.Rate,{onSubmit:r=>a(o=>({...o,rate:r})),header:c.title,children:s.jsx(l.TextArea,{placeholder:d,style:{marginTop:"30px"},value:e.note,onChange:({target:{value:r}})=>a(o=>({...o,note:r}))})}):s.jsxs(l.Stack,{$gap:30,children:[s.jsx(l.Title,{children:T}),s.jsx(l.Text,{children:i}),s.jsx(l.TextArea,{placeholder:d,value:e.note,onChange:({target:{value:r}})=>a(o=>({...o,note:r}))}),s.jsx(l.Button,{type:"submit",mode:"primary",style:{width:"fit-content",alignSelf:"center"},children:e.note.length?x("RateCourse.SendAnswer"):x("RateCourse.NoAnswer")})]})})},M=({course:c,courseId:d,visible:g,questionnaire:t,onClose:x})=>{var o;const{sendQuestionnaireAnswer:T}=p.useContext(w.EscolaLMSContext),{t:i}=j(),[e,a]=p.useState({loading:!1,step:0,showLastScreen:!1}),m=p.useCallback(async(u,h)=>{if(t.questions){a(n=>({...n,loading:!0}));try{(await T(c,d,t.id,{question_id:t.questions[e.step].id,rate:u,note:h,visible_on_front:t.questions[e.step].public_answers})).success&&f.success(`${i("RateCourse.ThankYouMessage")}`)}catch(n){f.error("Error"),console.error(n)}finally{a(n=>({...n,loading:!1,step:n.step+1,note:"",rating:null}))}}},[c,d,t.id,e]),r=p.useCallback((u,h)=>{m(u,h),t.questions&&e.step===t.questions.length-1&&a(n=>({...n,showLastScreen:!0}))},[t,e.step,m]);return s.jsx(C.Modal,{onClose:x,visible:g,animation:"zoom",maskAnimation:"fade",destroyOnClose:!0,width:468,children:e.showLastScreen?s.jsxs(S.Fragment,{children:[s.jsx(y.Title,{level:4,className:"modal-title",style:{paddingTop:"50px"},children:i("RateCourse.ThankYou")}),s.jsx(R.Text,{style:{paddingBottom:"50px",textAlign:"center"},children:i("RateCourse.ThankYouMessage")})]}):t.questions&&s.jsx(A,{textareaPlaceholder:i("RateCourse.OptionalComment"),data:t.questions[e.step],handleSubmit:(u,h)=>r(u,h),withStarsRating:((o=t.questions[e.step])==null?void 0:o.type)===b.REVIEW})})};export{M as R};
