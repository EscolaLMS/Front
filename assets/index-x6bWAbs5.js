import{f as w,r as p,j as s,cl as T,cm as f,ae as R,o as C,T as S,p as y,A as b,z as j,w as A,b as k}from"./index-DPt-kbd_.js";import{a as _}from"./questionnaires-COZ3EFCJ.js";const E=({data:i,textareaPlaceholder:c,withStarsRating:m,handleSubmit:t})=>{const{t:h}=w(),{title:g,description:l}=i,[e,n]=p.useState({rate:0,note:""}),x=()=>{t(e.rate,e.note),n({rate:0,note:""})};return s.jsx("form",{onSubmit:x,children:m?s.jsx(T,{onSubmit:r=>n(o=>({...o,rate:r})),header:i.title,children:s.jsx(f,{placeholder:c,style:{marginTop:"30px"},value:e.note,onChange:({target:{value:r}})=>n(o=>({...o,note:r}))})}):s.jsxs(R,{$gap:30,children:[s.jsx(C.Title,{children:g}),s.jsx(S.Text,{children:l}),s.jsx(f,{placeholder:c,value:e.note,onChange:({target:{value:r}})=>n(o=>({...o,note:r}))}),s.jsx(y.Button,{type:"submit",mode:"primary",style:{width:"fit-content",alignSelf:"center"},children:e.note.length?h("RateCourse.SendAnswer"):h("RateCourse.NoAnswer")})]})})},v=({course:i,courseId:c,visible:m,questionnaire:t,onClose:h})=>{var o;const{sendQuestionnaireAnswer:g}=p.useContext(b.EscolaLMSContext),{t:l}=w(),[e,n]=p.useState({loading:!1,step:0,showLastScreen:!1}),x=p.useCallback(async(d,u)=>{if(t.questions){n(a=>({...a,loading:!0}));try{(await g(i,c,t.id,{question_id:t.questions[e.step].id,rate:d,note:u,visible_on_front:t.questions[e.step].public_answers})).success&&j.success(`${l("RateCourse.ThankYouMessage")}`)}catch(a){j.error("Error"),console.error(a)}finally{n(a=>({...a,loading:!1,step:a.step+1,note:"",rating:null}))}}},[i,c,t.id,e]),r=p.useCallback((d,u)=>{x(d,u),t.questions&&e.step===t.questions.length-1&&n(a=>({...a,showLastScreen:!0}))},[t,e.step,x]);return s.jsx(A.Modal,{onClose:h,visible:m,animation:"zoom",maskAnimation:"fade",destroyOnClose:!0,width:468,children:e.showLastScreen?s.jsxs(k.Fragment,{children:[s.jsx(C.Title,{level:4,className:"modal-title",style:{paddingTop:"50px"},children:l("RateCourse.ThankYou")}),s.jsx(S.Text,{style:{paddingBottom:"50px",textAlign:"center"},children:l("RateCourse.ThankYouMessage")})]}):t.questions&&s.jsx(E,{textareaPlaceholder:l("RateCourse.OptionalComment"),data:t.questions[e.step],handleSubmit:(d,u)=>r(d,u),withStarsRating:((o=t.questions[e.step])==null?void 0:o.type)===_.REVIEW})})};export{v as R};
