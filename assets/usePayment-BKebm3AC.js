import{r as i,h as B,f as M,i as k,l as R,aR as o,cD as l}from"./index-qD7U5zMV.js";const q=()=>{var m,E,v;const{user:e,cart:d,fetchCart:x,removeFromCart:$,payWithStripe:f,payWithP24:p,subscriptionPayWithP24:y,courses:h,realizeVoucher:P}=i.useContext(B.EscolaLMSContext),{t}=M(),{push:n,location:g}=k(),[S,r]=i.useState(!1),[w,C]=i.useState(d.value.additional_discount>0?"granted":void 0);i.useEffect(()=>{!e.loading&&!e.value&&n(R.login)},[]);const b=i.useCallback(async u=>{var a;r(!0);try{if(!((a=e.value)!=null&&a.email)){o.error(`${t("MissingEmailError")}`),r(!1);return}await f(u,`${l}/#/cart?status=success`),r(!1),n("/cart?status=success")}catch(c){o.error(`${t("UnexpectedError")}`),r(!1),console.error(c)}},[f,n,t,(m=e.value)==null?void 0:m.email]),U=i.useCallback(async u=>{var a,c;r(!0);try{if(!((a=e.value)!=null&&a.email)){o.error(`${t("MissingEmailError")}`),r(!1);return}const s=await p((c=e.value)==null?void 0:c.email,`${l}/#/cart?status=success`,u||void 0);if(s.data.redirect_url===void 0){o.error(`${t("UnexpectedError")}`),r(!1);return}r(!1),window.open(s.data.redirect_url)}catch(s){o.error(`${t("UnexpectedError")}`),r(!1),console.error(s)}},[p,t,(E=e.value)==null?void 0:E.email]),_=i.useCallback(async u=>{var a,c;if(r(!0),!((a=e.value)!=null&&a.email)){o.error(`${t("MissingEmailError")}`),r(!1);return}try{const s=await y(u,(c=e.value)==null?void 0:c.email,`${l}/#/cart?status=success`);if(s.data.redirect_url===void 0){o.error(`${t("UnexpectedError")}`),r(!1);return}r(!1),window.open(s.data.redirect_url)}catch{o.error(`${t("UnexpectedError")}`)}},[t,y,(v=e.value)==null?void 0:v.email]);return{user:e,processing:S,setProcessing:r,discountStatus:w,payByStripe:b,payByP24:U,removeFromCart:$,courses:h,cart:d,location:g,push:n,realizeVoucher:P,setDiscountStatus:C,fetchCart:x,buySubscriptionByP24:_}};export{q as u};
