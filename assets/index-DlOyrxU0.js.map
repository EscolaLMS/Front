{"version":3,"file":"index-DlOyrxU0.js","sources":["../../src/hooks/useLessonProgram.ts","../../src/components/Courses/Course/CourseSidebar/index.tsx","../../src/components/Courses/Course/CourseProgramLessonsPreview.tsx","../../src/pages/courses/preview/index.tsx"],"sourcesContent":["import { useCallback, useContext, useEffect, useMemo, useState } from \"react\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport { API } from \"@escolalms/sdk/lib\";\nimport { EscolaLMSContext } from \"@escolalms/sdk/lib/react\";\nimport {\n  getFlatLessons,\n  getFlatTopics,\n} from \"@escolalms/components/lib/utils/course\";\n\nexport function useLessonProgram(\n  program: API.CourseProgram,\n  courseRouteName: string = \"/course/\"\n) {\n  const {\n    sendProgress,\n    getNextPrevTopic,\n    progress,\n    courseProgressDetails,\n    fetchProgress,\n  } = useContext(EscolaLMSContext);\n  const [isNextTopicButtonDisabled, disableNextTopicButton] = useState(false);\n  const { lessonID, topicID } = useParams<{\n    lessonID: string;\n    topicID: string;\n  }>();\n  const { push } = useHistory();\n\n  const flatLessons = useMemo(\n    () => getFlatLessons(program?.lessons ?? []),\n    [program?.lessons]\n  );\n  const flatTopics = useMemo(\n    () => getFlatTopics(program?.lessons ?? []),\n    [program?.lessons]\n  );\n\n  const lessonId = lessonID ? Number(lessonID) : flatLessons?.[0]?.id;\n  const topicId = topicID ? Number(topicID) : flatTopics?.[0]?.id;\n\n  useEffect(() => {\n    if (!topicId) return;\n    fetchProgress();\n  }, [fetchProgress, topicId]);\n\n  const lesson = useMemo(\n    () => flatLessons.find((lesson) => lesson.id === lessonId),\n    [flatLessons, lessonId]\n  );\n\n  const topic = useMemo(\n    () => flatTopics.find((topic) => topic.id === topicId),\n    [flatTopics, topicId]\n  );\n\n  const isLastTopic = useMemo(\n    () => flatTopics.at(-1)?.id === topic?.id,\n    [flatTopics, topic?.id]\n  );\n\n  const onNextTopic = useCallback(() => {\n    program.id &&\n      sendProgress(program.id, [{ topic_id: Number(topicId), status: 1 }]).then(\n        () => {\n          const nextTopic = getNextPrevTopic(Number(topicId));\n          nextTopic &&\n            push(\n              `${courseRouteName}${program.id}/${nextTopic.lesson_id}/${nextTopic.id}`,\n              null\n            );\n        }\n      );\n  }, [topicId, program, push, getNextPrevTopic, sendProgress, courseRouteName]);\n  const onPrevTopic = useCallback(() => {\n    const prevTopic = getNextPrevTopic(Number(topicId), false);\n    if (program.id && topic?.can_skip) {\n      sendProgress(program.id, [{ topic_id: Number(topicId), status: 1 }]).then(\n        () => {\n          prevTopic &&\n            push(\n              `${courseRouteName}${program.id}/${prevTopic.lesson_id}/${prevTopic.id}`,\n              null\n            );\n        }\n      );\n      return;\n    }\n    prevTopic &&\n      push(\n        `${courseRouteName}${program.id}/${prevTopic.lesson_id}/${prevTopic.id}`,\n        null\n      );\n  }, [\n    topicId,\n    program,\n    push,\n    getNextPrevTopic,\n    sendProgress,\n    courseRouteName,\n    topic,\n  ]);\n\n  const onNextTopicPreview = useCallback(\n    (next = true) => {\n      const nextTopic = getNextPrevTopic(Number(topicId), next);\n\n      nextTopic &&\n        push(\n          `${courseRouteName}${program.id}/${nextTopic?.lesson_id}/${nextTopic?.id}`\n        );\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [lessonId, topicId, program, program.id, push, courseRouteName]\n  );\n\n  return {\n    topic,\n    lesson,\n    onNextTopic,\n    onPrevTopic,\n    getNextPrevTopic,\n    isNextTopicButtonDisabled,\n    disableNextTopicButton,\n    onNextTopicPreview,\n    sendProgress,\n    progress,\n    courseProgressDetails,\n    isLastTopic,\n  } as const;\n}\n","import React, { useContext, useState, useMemo } from \"react\";\nimport { t } from \"i18next\";\nimport { isAfter } from \"date-fns\";\nimport { API } from \"@escolalms/sdk/lib\";\nimport { useHistory } from \"react-router-dom\";\nimport { isMobile } from \"react-device-detect\";\nimport styled, { css } from \"styled-components\";\nimport { CourseAgenda } from \"@escolalms/components/lib/components/organisms/CourseAgenda/CourseAgenda\";\nimport { EscolaLMSContext } from \"@escolalms/sdk/lib/react\";\nimport { getFlatTopics } from \"@escolalms/components/lib/utils/course\";\nimport { useLessonProgram } from \"@/hooks/useLessonProgram\";\nimport { Button } from \"@escolalms/components/lib/components/atoms/Button/Button\";\nimport { userIsCourseAuthor } from \"@/utils/index\";\n\nconst StyledSidebar = styled.aside`\n  padding-bottom: 100px;\n  .show-agenda-btn {\n    width: 100%;\n  }\n  .agenda-wrapper {\n    ${isMobile &&\n    css`\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      transform: translate(100%, 0);\n      transition: transform 0.25s;\n      overflow: scroll;\n      padding: 40px 0 55px;\n      z-index: 10;\n      background-color: ${({ theme }) =>\n        theme.mode === \"dark\" ? theme.dm__background : theme.background};\n      &--visible {\n        transform: translate(0, 0);\n      }\n      .hide-agenda-btn {\n        display: block;\n        margin: 0 15px 0 auto;\n      }\n    `}\n  }\n`;\n\nexport const CourseSidebar: React.FC<{\n  course: API.CourseProgram;\n  topicId: number;\n  onCompleteTopic?: () => void;\n  onCourseFinish?: () => void;\n}> = ({ course, topicId, onCompleteTopic, onCourseFinish }) => {\n  const { progress } = useLessonProgram(course);\n  const {\n    courseProgressDetails,\n    user,\n    program: courseProgram,\n  } = useContext(EscolaLMSContext);\n  const currentCourseProgram = useMemo(\n    () => courseProgram.value,\n    [courseProgram.value]\n  );\n  const currentCourseProgress = useMemo(\n    () =>\n      (progress.value ?? []).find(\n        ({ course: { id } }) => id === Number(course.id)\n      ),\n    [progress, course.id]\n  );\n\n  const history = useHistory();\n  const [agendaVisible, setAgendaVisible] = useState(false);\n  const program = (course?.lessons || []).filter(\n    (lesson) => (lesson?.topics?.length ?? 0) > 0\n  );\n  const { topicIsFinished } = useContext(EscolaLMSContext);\n  const flatTopics = useMemo(\n    () => getFlatTopics(course.lessons ?? []),\n    [course.lessons]\n  );\n\n  const getCourseProgress = useMemo(() => {\n    const courseId = course.id;\n    if (\n      courseProgressDetails &&\n      courseProgressDetails.byId &&\n      courseProgressDetails.byId[Number(courseId)] &&\n      courseProgressDetails.byId[Number(courseId)].value\n    ) {\n      return courseProgressDetails.byId[Number(courseId)].value;\n    }\n    return (\n      progress &&\n      progress.value &&\n      progress.value.find(\n        (courseProgress: API.CourseProgressItem) =>\n          courseProgress.course.id === Number(courseId)\n      )?.progress\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [progress, course]);\n\n  const finishedTopics = flatTopics\n    .filter((item: API.Topic) => {\n      return (\n        topicIsFinished(item.id) ||\n        getCourseProgress?.some(\n          (progressItem) =>\n            progressItem.topic_id === item.id && progressItem.status === 1\n        )\n      );\n    })\n    .map((item: API.Topic) => item.id);\n\n  const availableTopicsIds = useMemo(() => {\n    const activeLessons = (currentCourseProgram?.lessons ?? []).filter(\n      (l) =>\n        l.active_from === null ||\n        (l.active_from && isAfter(new Date(), new Date(l.active_from)))\n    );\n\n    const activeLessonsFlatTopics = getFlatTopics(activeLessons);\n\n    const { incomplete, in_progress, complete } =\n      activeLessonsFlatTopics.reduce<{\n        in_progress: number[];\n        complete: number[];\n        incomplete: number[];\n      }>(\n        (acc, t) => {\n          const el = (currentCourseProgress?.progress ?? []).find(\n            ({ topic_id }) => topic_id === t.id\n          );\n          if (!el) return acc;\n\n          const statusMap = {\n            [API.CourseProgressItemElementStatus.INCOMPLETE]: \"incomplete\",\n            [API.CourseProgressItemElementStatus.COMPLETE]: \"complete\",\n            [API.CourseProgressItemElementStatus.IN_PROGRESS]: \"in_progress\",\n          } as const;\n\n          return {\n            ...acc,\n            [statusMap[el.status]]: [...acc[statusMap[el.status]], t.id],\n          };\n        },\n        {\n          in_progress: [],\n          incomplete: [],\n          complete: [],\n        }\n      );\n\n    if (in_progress.length) return [...in_progress, ...complete];\n\n    const firstInCompletedLessonId = incomplete?.[0] ? [incomplete[0]] : [];\n    return [...complete, ...firstInCompletedLessonId];\n  }, [currentCourseProgram?.lessons, currentCourseProgress?.progress]);\n\n  if (!course && !program) {\n    return <React.Fragment />;\n  }\n  return (\n    <StyledSidebar>\n      {isMobile && (\n        <Button\n          mode=\"outline\"\n          className=\"show-agenda-btn\"\n          onClick={() => setAgendaVisible(true)}\n        >\n          {t(\"CourseProgram.ShowAgenda\").toString()}\n        </Button>\n      )}\n      <div\n        className={`${\n          agendaVisible\n            ? \"agenda-wrapper agenda-wrapper--visible\"\n            : \"agenda-wrapper\"\n        }`}\n      >\n        {isMobile && (\n          <Button\n            className=\"hide-agenda-btn\"\n            mode=\"secondary\"\n            onClick={() => setAgendaVisible(false)}\n          >\n            &#10005;\n          </Button>\n        )}\n        <CourseAgenda\n          areAllTopicsUnlocked={userIsCourseAuthor(\n            Number(user.value?.id),\n            course\n          )}\n          // onNextTopicClick={() => {\n          //   const currentTopicIndex = flatTopics.findIndex(\n          //     (t) => t.id === topicId\n          //   );\n          //   const nextTopic = flatTopics?.[currentTopicIndex + 1];\n\n          //   if (nextTopic && currentTopicIndex !== -1) {\n          //     history.push(\n          //       `/course/${course.id}/${nextTopic.lesson_id}/${nextTopic.id}`\n          //     );\n          //     setAgendaVisible(false);\n          //   }\n          // }}\n          // mobile={isMobile}\n          lessons={course.lessons}\n          currentTopicId={topicId}\n          finishedTopicIds={finishedTopics}\n          onMarkFinished={() => onCompleteTopic?.()}\n          onTopicClick={(topic: API.Topic) => {\n            history.push(`/course/${course.id}/${topic.lesson_id}/${topic.id}`);\n            setAgendaVisible(false);\n          }}\n          onCourseFinished={() => onCourseFinish?.()}\n          availableTopicsIds={availableTopicsIds}\n        />\n      </div>\n    </StyledSidebar>\n  );\n};\n\nexport default CourseSidebar;\n","import React, { useEffect } from \"react\";\nimport { API } from \"@escolalms/sdk/lib\";\nimport CourseProgramContent from \"@/components/Courses/Course/CourseProgramContent\";\nimport CourseSidebar from \"@/components/Courses/Course/CourseSidebar\";\nimport { useLessonProgram } from \"@/hooks/useLessonProgram\";\nimport { useTranslation } from \"react-i18next\";\nimport { MarkdownRenderer } from \"@escolalms/components/lib/components/molecules/MarkdownRenderer/MarkdownRenderer\";\nimport { Col, Row } from \"react-grid-system\";\n\nexport const CourseProgramLessonsPreview: React.FC<{\n  program: API.CourseProgram;\n}> = ({ program }) => {\n  const { topic, lesson, onNextTopicPreview } = useLessonProgram(\n    program,\n    `/courses/preview/`\n  );\n\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\n  }, [topic?.id, lesson?.id]);\n\n  return (\n    <React.Fragment>\n      <div className=\"course-program course-program-page\">\n        <div className=\"course-program-container\">\n          <div className=\"course-program-wrapper course-program-wrapper-preview\">\n            <div className=\"course-program-player\">\n              <div className=\"course-program-player-content\">\n                <h2>{topic?.title}</h2>\n                {topic && topic.introduction && (\n                  <Col sm={12} md={12} lg={12}>\n                    <div className=\"container-md\">\n                      <MarkdownRenderer>{topic.introduction}</MarkdownRenderer>\n                    </div>\n                  </Col>\n                )}\n                <div\n                  className=\"course-program-player-content__wrapper\"\n                  style={{\n                    ...((topic?.json?.wrapperStyle as object) || {}),\n                  }}\n                >\n                  <CourseProgramContent preview={true} topic={topic} />\n                </div>\n              </div>\n\n              <Row>\n                {lesson && lesson.summary && (\n                  <Col sm={12} md={12} lg={12}>\n                    <div className=\"course-program-summary\">\n                      <MarkdownRenderer>{lesson.summary}</MarkdownRenderer>\n                    </div>\n                  </Col>\n                )}\n                {topic && topic.summary && (\n                  <Col sm={12} md={12} lg={12}>\n                    <div className=\"course-program-summary\">\n                      <MarkdownRenderer>{topic.summary}</MarkdownRenderer>\n                      {/* Leave it in case the business changes its mind. */}\n                      {/* {topic && topic.resources && topic.resources?.length > 0 && (\n                        <React.Fragment>\n                          <h3>{t('CourseProgram.TopicAttachment')}</h3>\n                          <div className=\"file-list\">\n                            {topic.resources.map((resource) => (\n                              <a target=\"_blank\" href={resource.url} rel=\"noreferrer\">\n                                {resource.name}\n                              </a>\n                            ))}\n                          </div>\n                        </React.Fragment>\n                      )} */}\n                    </div>\n                  </Col>\n                )}\n              </Row>\n\n              <div className=\"course-program-player-next\">\n                <button\n                  className={`default-btn default-btn-equal`}\n                  onClick={() => onNextTopicPreview()}\n                >\n                  <div className=\"course-program-player-next-button__wrapper\">\n                    {t(\"Next Topic\")} &gt;\n                  </div>\n                  <span></span>\n                </button>\n              </div>\n            </div>\n            <CourseSidebar course={program} topicId={Number(topic?.id)} />\n          </div>\n        </div>\n      </div>\n    </React.Fragment>\n  );\n};\n\nexport default CourseProgramLessonsPreview;\n","import React, { useContext, useEffect, useRef, useState } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { API } from \"@escolalms/sdk/lib\";\nimport { useTranslation } from \"react-i18next\";\nimport { EscolaLMSContext } from \"@escolalms/sdk/lib/react/context\";\nimport Preloader from \"@/components/_App/Preloader\";\nimport Layout from \"@/components/_App/Layout\";\nimport { ScormPreview } from \"@escolalms/scorm-player\";\nimport CourseProgramLessonsPreview from \"@/components/Courses/Course/CourseProgramLessonsPreview\";\nimport Container from \"@/components/Common/Container\";\nimport routeRoutes from \"@/components/Routes/routes\";\n\n// TODO: 99% same as: src/pages/course/index.tsx\n\nconst CourseProgramScorm: React.FC<{ program: API.CourseProgram }> = ({\n  program,\n}) => {\n  const sco = program?.scorm?.scos?.find((sco) => sco.entry_url !== undefined);\n  const uuid = sco?.uuid;\n  const iframeRef = useRef<HTMLIFrameElement>(null);\n  const [height, setHeight] = useState(0);\n  const headerAndFooterHeight = 610;\n  const { apiUrl } = useContext(EscolaLMSContext);\n\n  useEffect(() => {\n    if (iframeRef.current) {\n      setHeight(\n        iframeRef.current?.contentWindow?.document?.body?.scrollHeight || 0\n      );\n    }\n  }, [iframeRef]);\n\n  if (!sco && !uuid) {\n    return <React.Fragment />;\n  }\n\n  return (\n    <React.Fragment>\n      <div className=\"container-fluid course-program\">\n        <div\n          className=\"course-program-player scorm\"\n          style={{\n            height: `${headerAndFooterHeight + height}px`,\n          }}\n        >\n          {uuid && (\n            <ScormPreview\n              uuid={uuid}\n              apiUrl={apiUrl}\n              serviceWorkerUrl=\"./service-worker-scorm.js\"\n            />\n          )}\n\n          {/* <iframe\n            title={\"scorm-player\"}\n            ref={iframeRef}\n            src={`${apiUrl}/api/scorm/play/${uuid}`}\n            scrolling=\"no\"\n          /> */}\n        </div>\n      </div>\n    </React.Fragment>\n  );\n};\n\nconst CourseProgram = () => {\n  const { t } = useTranslation();\n\n  const { id } = useParams<{ id: string }>();\n  const { program, fetchProgram } = useContext(EscolaLMSContext);\n\n  useEffect(() => {\n    if (id) {\n      fetchProgram(Number(id));\n    }\n  }, [id, fetchProgram]);\n\n  if (program.loading) {\n    return <Preloader />;\n  }\n\n  if (program.error) {\n    return (\n      <Container>\n        <div className=\"alert alert-danger\" role=\"alert\">\n          <h4 className=\"alert-heading\">{t(\"Error\")}</h4>\n          <p> {program.error.message || program.error.error}</p>\n          <hr />\n          <p className=\"mb-0\">\n            {t(\"CoursePage.Preview.SeeOther\")}\n            <Link to={routeRoutes.courses}>{t(\"Courses\")}</Link>.\n          </p>\n        </div>\n      </Container>\n    );\n  }\n\n  if (program.value && program?.value?.scorm?.id) {\n    return (\n      <Layout>\n        <CourseProgramScorm program={program.value} />\n      </Layout>\n    );\n  }\n  if (program.value && program.value.lessons && program.value.lessons.length) {\n    return (\n      <Layout>\n        <CourseProgramLessonsPreview program={program.value} />;\n      </Layout>\n    );\n  }\n\n  return <Preloader />;\n};\n\nexport default CourseProgram;\n"],"names":["useLessonProgram","program","courseRouteName","sendProgress","getNextPrevTopic","progress","courseProgressDetails","fetchProgress","useContext","EscolaLMSContext","isNextTopicButtonDisabled","disableNextTopicButton","useState","lessonID","topicID","useParams","push","useHistory","flatLessons","useMemo","getFlatLessons","flatTopics","getFlatTopics","lessonId","_a","topicId","_b","useEffect","lesson","topic","isLastTopic","onNextTopic","useCallback","nextTopic","onPrevTopic","prevTopic","onNextTopicPreview","next","StyledSidebar","styled","isMobile","css","theme","CourseSidebar","course","onCompleteTopic","onCourseFinish","user","courseProgram","currentCourseProgram","currentCourseProgress","id","history","agendaVisible","setAgendaVisible","topicIsFinished","getCourseProgress","courseId","courseProgress","finishedTopics","item","progressItem","availableTopicsIds","activeLessons","l","isAfter","activeLessonsFlatTopics","incomplete","in_progress","complete","acc","t","el","topic_id","statusMap","API","firstInCompletedLessonId","jsx","React","Button","jsxs","CourseAgenda","userIsCourseAuthor","CourseProgramLessonsPreview","useTranslation","Col","MarkdownRenderer","CourseProgramContent","Row","CourseProgramScorm","sco","uuid","iframeRef","useRef","height","setHeight","headerAndFooterHeight","apiUrl","_d","_c","ScormPreview","CourseProgram","fetchProgram","Preloader","Container","Link","routeRoutes","Layout"],"mappings":"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"}