import{r as u,m as M,f as k,h as B,bg as l}from"./index-BZyw651V.js";import{t as o}from"./toast-Dotuji2T.js";const L=()=>{var y,E,v;const{user:t,cart:d,fetchCart:x,removeFromCart:$,payWithStripe:p,payWithP24:f,subscriptionPayWithP24:m,courses:h,realizeVoucher:P}=u.useContext(M.EscolaLMSContext),{t:e}=k(),{push:n,location:S}=B(),[b,r]=u.useState(!1),[g,w]=u.useState(d.value.additional_discount>0?"granted":void 0),C=u.useCallback(async i=>{var a;r(!0);try{if(!((a=t.value)!=null&&a.email)){o(`${e("MissingEmailError")}`,"error"),r(!1);return}await p(i,`${l}/#/cart?status=success`),r(!1),n("/cart?status=success")}catch(c){o(`${e("UnexpectedError")}`,"error"),r(!1),console.error(c)}},[p,n,e,(y=t.value)==null?void 0:y.email]),U=u.useCallback(async i=>{var a,c;r(!0);try{if(!((a=t.value)!=null&&a.email)){o(`${e("MissingEmailError")}`,"error"),r(!1);return}const s=await f((c=t.value)==null?void 0:c.email,`${l}/#/cart?status=success`,i||void 0);if(s.data.redirect_url===void 0){o(`${e("UnexpectedError")}`,"error"),r(!1);return}r(!1),window.open(s.data.redirect_url)}catch(s){o(`${e("UnexpectedError")}`,"error"),r(!1),console.error(s)}},[f,e,(E=t.value)==null?void 0:E.email]),_=u.useCallback(async i=>{var a,c;if(r(!0),!((a=t.value)!=null&&a.email)){o(`${e("MissingEmailError")}`,"error"),r(!1);return}try{const s=await m(i,(c=t.value)==null?void 0:c.email,`${l}/#/cart?status=success`);if(s.data.redirect_url===void 0){o(`${e("UnexpectedError")}`,"error"),r(!1);return}r(!1),window.open(s.data.redirect_url)}catch{o(`${e("UnexpectedError")}`,"error")}},[e,m,(v=t.value)==null?void 0:v.email]);return{user:t,processing:b,setProcessing:r,discountStatus:g,payByStripe:C,payByP24:U,removeFromCart:$,courses:h,cart:d,location:S,push:n,realizeVoucher:P,setDiscountStatus:w,fetchCart:x,buySubscriptionByP24:_}};export{L as u};
