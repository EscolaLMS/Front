{"version":3,"file":"index-B1RjAZH8.js","sources":["../../src/components/Subscriptions/ActiveSubscription/index.tsx","../../src/components/Subscriptions/Box/index.tsx"],"sourcesContent":["import styled from \"styled-components\";\nimport { useTranslation } from \"react-i18next\";\nimport { getStylesBasedOnTheme } from \"@escolalms/components/lib/utils/utils\";\nimport { Text } from \"@escolalms/components/lib/components/atoms/Typography/Text\";\n\nimport { formatDate } from \"@/utils/date\";\nimport { StarIcon } from \"@/icons/index\";\nimport { Button } from \"@escolalms/components/lib/components/atoms/Button/Button\";\nimport { useCallback, useState } from \"react\";\n\nenum SubscriptionStatus {\n  ACTIVE = \"active\",\n  CANCELED = \"cancelled\",\n}\n\nconst StyledInfoBox = styled.div`\n  border-radius: ${({ theme }) => theme.buttonRadius}px;\n  background-color: ${({ theme }) =>\n    getStylesBasedOnTheme(theme.mode, theme.black, theme.white, \"black\")};\n  padding: 22px;\n  margin-top: 10px;\n  margin-bottom: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 6px;\n  @media (max-width: 768px) {\n    flex-direction: column;\n  }\n  > div {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n  }\n  .${SubscriptionStatus.CANCELED} {\n    color: ${({ theme }) => theme.primaryColor};\n    @media (max-width: 768px) {\n      padding-left: 20px;\n    }\n  }\n`;\n\ntype Props = {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  activeSubscription: any;\n  subscriptionCancel: (id: number) => void;\n};\n\nconst ActiveSubscription: React.FC<Props> = ({\n  activeSubscription,\n  subscriptionCancel,\n}) => {\n  const [subStatus, setSubSatuts] = useState(\n    activeSubscription?.status || SubscriptionStatus.ACTIVE\n  );\n  const { t } = useTranslation();\n\n  const handleSubscriptionCancel = useCallback(() => {\n    setSubSatuts(SubscriptionStatus.CANCELED);\n    subscriptionCancel(activeSubscription.id);\n  }, [activeSubscription?.id, subscriptionCancel]);\n\n  return (\n    <StyledInfoBox className=\"info-box\">\n      <div>\n        {activeSubscription && <StarIcon />}\n        <Text>\n          {activeSubscription\n            ? t(\"Subscriptions.ActiveSubscription\", {\n                date: formatDate(\n                  // TODO: when ts models are ready, remove  this comment\n                  // @ts-ignore\n                  activeSubscription.end_date,\n                  \"dd.MM.yyyy\"\n                ),\n              })\n            : t(\"Subscriptions.NoSubscription\")}\n        </Text>\n      </div>\n      {subStatus === SubscriptionStatus.CANCELED && (\n        <Text className={SubscriptionStatus.CANCELED}>\n          {t(\"Subscriptions.Cancelled\")}\n        </Text>\n      )}\n      {activeSubscription && subStatus === SubscriptionStatus.ACTIVE && (\n        <Button onClick={handleSubscriptionCancel}>Anuluj subskrypcję</Button>\n      )}\n    </StyledInfoBox>\n  );\n};\n\nexport default ActiveSubscription;\n","import { Purchases } from \"@revenuecat/purchases-capacitor\";\nimport { useCallback, useEffect, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useHistory } from \"react-router-dom\";\nimport { Capacitor } from \"@capacitor/core\";\nimport styled from \"styled-components\";\nimport routeRoutes from \"@/components/Routes/routes\";\nimport { VITE_APP_ANDROID_APIKEY, VITE_APP_IOS_APIKEY } from \"@/config/index\";\nimport usePayment from \"@/hooks/usePayment\";\nimport { StarIcon } from \"@/icons/index\";\nimport { formatPrice, isMobilePlatform } from \"@/utils/index\";\nimport {\n  findProductByIdentifier,\n  getRevenuecatIdForSubscription,\n  revenuecatErrorHandler,\n} from \"@/utils/payment\";\nimport { Button } from \"@escolalms/components/lib/components/atoms/Button/Button\";\nimport { Text } from \"@escolalms/components/lib/components/atoms/Typography/Text\";\nimport { Title } from \"@escolalms/components/lib/components/atoms/Typography/Title\";\nimport { getStylesBasedOnTheme } from \"@escolalms/components/lib/utils/utils\";\nimport { CapacitorPaymentError } from \"@/types/index\";\n\nconst StyledSubscription = styled.div<{ $isMobile: boolean }>`\n  border-radius: ${({ theme }) => theme.cardRadius}px;\n  border: 1px solid ${({ theme }) => theme.gray3};\n  padding: ${({ $isMobile }) => ($isMobile ? \"20px\" : \"23px 75px\")};\n  transition: border 0.3s ease-in-out;\n  margin-bottom: ${({ $isMobile }) => ($isMobile ? \"30px\" : \"30px\")};\n  background-color: ${({ theme }) =>\n    getStylesBasedOnTheme(theme.mode, theme.black, theme.white, \"black\")};\n  .content {\n    text-align: center;\n    max-width: 210px;\n    position: relative;\n    margin: 0 auto;\n\n    p {\n      margin-bottom: 0;\n    }\n    .information {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 2.5px;\n      margin-top: 5px;\n      background-color: ${({ theme }) => theme.secondaryColor};\n    }\n    .divider {\n      width: 21px;\n      height: 3px;\n      border-radius: 18px;\n      background-color: ${({ theme }) => theme.primaryColor};\n      margin: 23px auto 16px auto;\n    }\n    .description {\n      margin-bottom: 17px;\n    }\n    .price {\n      margin-bottom: 30px;\n    }\n    button {\n      width: 100%;\n    }\n    .tag {\n      position: absolute;\n      top: -37px;\n      left: 0;\n      right: 0;\n      margin: auto;\n      border-radius: 18px;\n      width: fit-content;\n      background-color: ${({ theme }) => theme.textColor};\n      padding: 3px 14px;\n\n      p {\n        text-transform: uppercase;\n        color: ${({ theme }) => theme.white};\n        margin-bottom: 0;\n      }\n    }\n  }\n\n  &:hover {\n    border: 1px solid #333333;\n  }\n`;\n\ntype Props = {\n  // TODO: when model types will be updated change this\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  subscription: any;\n};\n\nconst SubscriptionBox: React.FC<Props> = ({ subscription }) => {\n  const { t } = useTranslation();\n  const { buySubscriptionByP24, user } = usePayment();\n\n  const history = useHistory();\n  const showTag = useMemo(() => {\n    return subscription.tags && subscription.tags.includes(\"best-deal\");\n  }, [subscription.tags]);\n\n  const handleBuySubscription = useCallback(() => {\n    if (user.value?.id) {\n      buySubscriptionByP24(subscription.id);\n    } else {\n      history.push(routeRoutes.login);\n    }\n  }, [subscription.id, user.value?.id, buySubscriptionByP24, history]);\n\n  useEffect(() => {\n    (async function () {\n      const id = user?.value?.id;\n\n      if (Capacitor.getPlatform() === \"ios\") {\n        await Purchases.configure({\n          apiKey: VITE_APP_IOS_APIKEY,\n          appUserID: `${id}`,\n        });\n      } else if (Capacitor.getPlatform() === \"android\") {\n        await Purchases.configure({\n          apiKey: VITE_APP_ANDROID_APIKEY,\n          appUserID: `${id}`,\n        });\n      }\n    })();\n  }, [user?.value?.id]);\n\n  const buyOnMobile = useCallback(async () => {\n    if (!user.value?.id) {\n      history.push(routeRoutes.login);\n      return;\n    }\n    const id = getRevenuecatIdForSubscription(subscription);\n    const offerings = await Purchases.getOfferings();\n    const packages = offerings?.current?.availablePackages || [];\n\n    const product = findProductByIdentifier(packages, id);\n\n    if (product) {\n      try {\n        await Purchases.purchaseStoreProduct({\n          product: product,\n        });\n        // Redirect to course page\n        history.push(routeRoutes.home);\n      } catch (error) {\n        revenuecatErrorHandler(error as CapacitorPaymentError);\n      }\n    }\n  }, [history, subscription, user.value?.id]);\n\n  return (\n    <StyledSubscription $isMobile={isMobilePlatform}>\n      <div className=\"content\">\n        {showTag && (\n          <div className=\"tag\">\n            <Text size=\"13\">{t(\"Subscriptions.CheapestOffer\")}</Text>\n          </div>\n        )}\n\n        <Text>{t(\"Subscriptions.AccessVia\")}</Text>\n        <Title level={1} as={\"h4\"}>\n          {subscription.subscription_duration}{\" \"}\n          {t(`Subscriptions.Periods.${subscription.subscription_period}`)}\n        </Title>\n        <Text className=\"information\" size=\"13\">\n          <StarIcon /> {subscription.trial_duration}-\n          {t(`Subscriptions.Periods.${subscription.trial_period}`)}{\" \"}\n          {t(\"Subscriptions.TrialText\")}\n        </Text>\n        <div className=\"divider\"></div>\n        <Text size=\"13\" className=\"description\">\n          {subscription.name}\n        </Text>\n        <Text size=\"24\" className=\"price\" bold>\n          {formatPrice(subscription.gross_price)} zł\n        </Text>\n        {\n          <Button\n            mode=\"secondary\"\n            onClick={() => {\n              if (isMobilePlatform) {\n                buyOnMobile();\n                return;\n              }\n              handleBuySubscription();\n            }}\n          >\n            {t(\"Subscriptions.IPick\")}\n          </Button>\n        }\n      </div>\n    </StyledSubscription>\n  );\n};\n\nexport default SubscriptionBox;\n"],"names":["StyledInfoBox","styled","theme","getStylesBasedOnTheme","ActiveSubscription","activeSubscription","subscriptionCancel","subStatus","setSubSatuts","useState","t","useTranslation","handleSubscriptionCancel","useCallback","jsxs","StarIcon","jsx","Text","formatDate","Button","StyledSubscription","$isMobile","SubscriptionBox","subscription","buySubscriptionByP24","user","usePayment","history","useHistory","showTag","useMemo","handleBuySubscription","_a","routeRoutes","useEffect","id","Capacitor","Purchases","VITE_APP_IOS_APIKEY","VITE_APP_ANDROID_APIKEY","_b","buyOnMobile","getRevenuecatIdForSubscription","offerings","packages","product","findProductByIdentifier","error","revenuecatErrorHandler","_c","isMobilePlatform","Title","formatPrice"],"mappings":"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"}