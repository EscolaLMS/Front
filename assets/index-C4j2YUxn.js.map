{"version":3,"file":"index-C4j2YUxn.js","sources":["../../src/pages/login/index.tsx"],"sourcesContent":["import { useContext, useState } from \"react\";\nimport { EscolaLMSContext } from \"@escolalms/sdk/lib/react/context\";\nimport { useHistory } from \"react-router-dom\";\nimport Layout from \"@/components/_App/Layout\";\nimport { isMobile } from \"react-device-detect\";\nimport { useLocation } from \"react-router-dom\";\nimport { ResetPasswordForm } from \"@escolalms/components/lib/components/organisms/ResetPasswordForm/ResetPasswordForm\";\nimport { LoginForm } from \"@escolalms/components/lib/components/organisms/LoginForm/LoginForm\";\nimport { useTranslation } from \"react-i18next\";\nimport Container from \"@/components/Common/Container\";\nimport routeRoutes from \"@/components/Routes/routes\";\nimport AuthWrapper from \"@/components/Authentication/AuthWrapper\";\nimport { toast } from \"@/utils/toast\";\nimport { APP_URL } from \"@/config/index\";\nimport { redirectPrefix } from \"@/utils/router\";\nimport { isMobilePlatform } from \"@/utils/index\";\n\nconst Login = () => {\n  const { search, state } = useLocation<{ referrer?: string }>();\n  const { user, socialAuthorize } = useContext(EscolaLMSContext);\n  const [view, setView] = useState<\n    \"login\" | \"forgotPassword\" | \"register\" | \"success\"\n  >(\"login\");\n  const { t } = useTranslation();\n  const history = useHistory();\n  const token = search.split(\"?token=\")[1];\n  const referrer =\n    (state && state.referrer) || search.split(\"?referrer=\")[1] || \"/\";\n\n  if (token) {\n    socialAuthorize(token);\n    setTimeout(() => {\n      history.push(referrer);\n    }, 1000);\n  }\n\n  if (!user.loading && !token && user.value) {\n    history.push(referrer);\n  }\n\n  return (\n    <Layout metaTitle={t(\"LoginAndRegister\")}>\n      <AuthWrapper>\n        <Container>\n          {view === \"login\" ? (\n            <LoginForm\n              onResetPasswordLink={() => setView(\"forgotPassword\")}\n              onRegisterLink={() => history.push(routeRoutes.register)}\n              mobile={isMobile}\n              {...(isMobilePlatform\n                ? { submitText: \"Załóż darmowe konto\" }\n                : {})}\n            />\n          ) : (\n            <ResetPasswordForm\n              mobile={isMobile}\n              backToLogin={() => setView(\"login\")}\n              onRegisterLink={() => history.push(routeRoutes.register)}\n              return_url={`${APP_URL}${redirectPrefix()}${routeRoutes.reset}`}\n              onFirstStepSuccess={() =>\n                toast(t<string>(\"LoginPage.ForgotSuccess\"), \"success\")\n              }\n              onFirstStepError={() =>\n                toast(t<string>(\"UnexpectedError\"), \"error\")\n              }\n            />\n          )}\n        </Container>\n      </AuthWrapper>\n    </Layout>\n  );\n};\n\nexport default Login;\n"],"names":["Login","search","state","useLocation","user","socialAuthorize","useContext","EscolaLMSContext","view","setView","useState","t","useTranslation","history","useHistory","token","referrer","jsx","Layout","AuthWrapper","Container","LoginForm","routeRoutes","isMobile","isMobilePlatform","ResetPasswordForm","APP_URL","redirectPrefix","toast"],"mappings":"yMAiBA,MAAMA,EAAQ,IAAM,CAClB,KAAM,CAAE,OAAAC,EAAQ,MAAAC,CAAM,EAAIC,EAAmC,EACvD,CAAE,KAAAC,EAAM,gBAAAC,GAAoBC,EAAAA,WAAWC,EAAAA,gBAAgB,EACvD,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAEtB,OAAO,EACH,CAAE,EAAAC,CAAE,EAAIC,EAAe,EACvBC,EAAUC,EAAW,EACrBC,EAAQd,EAAO,MAAM,SAAS,EAAE,CAAC,EACjCe,EACHd,GAASA,EAAM,UAAaD,EAAO,MAAM,YAAY,EAAE,CAAC,GAAK,IAEhE,OAAIc,IACFV,EAAgBU,CAAK,EACrB,WAAW,IAAM,CACfF,EAAQ,KAAKG,CAAQ,GACpB,GAAI,GAGL,CAACZ,EAAK,SAAW,CAACW,GAASX,EAAK,OAClCS,EAAQ,KAAKG,CAAQ,EAIrBC,EAAAA,IAACC,EAAO,CAAA,UAAWP,EAAE,kBAAkB,EACrC,SAAAM,EAAAA,IAACE,EACC,CAAA,SAAAF,MAACG,EACE,CAAA,SAAAZ,IAAS,QACRS,EAAA,IAACI,EAAA,UAAA,CACC,oBAAqB,IAAMZ,EAAQ,gBAAgB,EACnD,eAAgB,IAAMI,EAAQ,KAAKS,EAAY,QAAQ,EACvD,OAAQC,EACP,GAAIC,EACD,CAAE,WAAY,uBACd,CAAA,CAAC,CAAA,EAGPP,EAAA,IAACQ,EAAA,kBAAA,CACC,OAAQF,EACR,YAAa,IAAMd,EAAQ,OAAO,EAClC,eAAgB,IAAMI,EAAQ,KAAKS,EAAY,QAAQ,EACvD,WAAY,GAAGI,CAAO,GAAGC,GAAgB,GAAGL,EAAY,KAAK,GAC7D,mBAAoB,IAClBM,EAAMjB,EAAU,yBAAyB,EAAG,SAAS,EAEvD,iBAAkB,IAChBiB,EAAMjB,EAAU,iBAAiB,EAAG,OAAO,CAAA,CAAA,CAInD,CAAA,CACF,CAAA,EACF,CAEJ"}