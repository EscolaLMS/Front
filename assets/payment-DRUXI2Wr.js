const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-DlnAG--z.js","assets/index-DMEaDbL2.js","assets/index-C2mcw6U_.css"])))=>i.map(i=>d[i]);
import{aM as Y,aN as X,r as s,K as z,h as $,I as O,Y as u,ar as d}from"./index-DMEaDbL2.js";var b=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,N){I.__proto__=N}||function(I,N){for(var o in N)Object.prototype.hasOwnProperty.call(N,o)&&(I[o]=N[o])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function I(){this.constructor=e}e.prototype=r===null?Object.create(r):(I.prototype=r.prototype,new I)}}(),T;(function(t){t.UNKNOWN_ERROR="0",t.PURCHASE_CANCELLED_ERROR="1",t.STORE_PROBLEM_ERROR="2",t.PURCHASE_NOT_ALLOWED_ERROR="3",t.PURCHASE_INVALID_ERROR="4",t.PRODUCT_NOT_AVAILABLE_FOR_PURCHASE_ERROR="5",t.PRODUCT_ALREADY_PURCHASED_ERROR="6",t.RECEIPT_ALREADY_IN_USE_ERROR="7",t.INVALID_RECEIPT_ERROR="8",t.MISSING_RECEIPT_FILE_ERROR="9",t.NETWORK_ERROR="10",t.INVALID_CREDENTIALS_ERROR="11",t.UNEXPECTED_BACKEND_RESPONSE_ERROR="12",t.RECEIPT_IN_USE_BY_OTHER_SUBSCRIBER_ERROR="13",t.INVALID_APP_USER_ID_ERROR="14",t.OPERATION_ALREADY_IN_PROGRESS_ERROR="15",t.UNKNOWN_BACKEND_ERROR="16",t.INVALID_APPLE_SUBSCRIPTION_KEY_ERROR="17",t.INELIGIBLE_ERROR="18",t.INSUFFICIENT_PERMISSIONS_ERROR="19",t.PAYMENT_PENDING_ERROR="20",t.INVALID_SUBSCRIBER_ATTRIBUTES_ERROR="21",t.LOG_OUT_ANONYMOUS_USER_ERROR="22",t.CONFIGURATION_ERROR="23",t.UNSUPPORTED_ERROR="24",t.EMPTY_SUBSCRIBER_ATTRIBUTES_ERROR="25",t.PRODUCT_DISCOUNT_MISSING_IDENTIFIER_ERROR="26",t.PRODUCT_DISCOUNT_MISSING_SUBSCRIPTION_GROUP_IDENTIFIER_ERROR="28",t.CUSTOMER_INFO_ERROR="29",t.SYSTEM_INFO_ERROR="30",t.BEGIN_REFUND_REQUEST_ERROR="31",t.PRODUCT_REQUEST_TIMED_OUT_ERROR="32",t.API_ENDPOINT_BLOCKED="33",t.INVALID_PROMOTIONAL_OFFER_ERROR="34",t.OFFLINE_CONNECTION_ERROR="35"})(T||(T={}));(function(t){b(e,t);function e(){var r=t.call(this,"There is no singleton instance. Make sure you configure Purchases before trying to get the default instance. More info here: https://errors.rev.cat/configuring-sdk")||this;return Object.setPrototypeOf(r,e.prototype),r}return e})(Error);(function(t){b(e,t);function e(){var r=t.call(this,"This method is not available in the current platform.")||this;return Object.setPrototypeOf(r,e.prototype),r}return e})(Error);var M;(function(t){t.UNKNOWN="UNKNOWN",t.CUSTOM="CUSTOM",t.LIFETIME="LIFETIME",t.ANNUAL="ANNUAL",t.SIX_MONTH="SIX_MONTH",t.THREE_MONTH="THREE_MONTH",t.TWO_MONTH="TWO_MONTH",t.MONTHLY="MONTHLY",t.WEEKLY="WEEKLY"})(M||(M={}));var h;(function(t){t[t.INTRO_ELIGIBILITY_STATUS_UNKNOWN=0]="INTRO_ELIGIBILITY_STATUS_UNKNOWN",t[t.INTRO_ELIGIBILITY_STATUS_INELIGIBLE=1]="INTRO_ELIGIBILITY_STATUS_INELIGIBLE",t[t.INTRO_ELIGIBILITY_STATUS_ELIGIBLE=2]="INTRO_ELIGIBILITY_STATUS_ELIGIBLE",t[t.INTRO_ELIGIBILITY_STATUS_NO_INTRO_OFFER_EXISTS=3]="INTRO_ELIGIBILITY_STATUS_NO_INTRO_OFFER_EXISTS"})(h||(h={}));var v;(function(t){t.NON_SUBSCRIPTION="NON_SUBSCRIPTION",t.SUBSCRIPTION="SUBSCRIPTION",t.UNKNOWN="UNKNOWN"})(v||(v={}));var A;(function(t){t.CONSUMABLE="CONSUMABLE",t.NON_CONSUMABLE="NON_CONSUMABLE",t.NON_RENEWABLE_SUBSCRIPTION="NON_RENEWABLE_SUBSCRIPTION",t.AUTO_RENEWABLE_SUBSCRIPTION="AUTO_RENEWABLE_SUBSCRIPTION",t.PREPAID_SUBSCRIPTION="PREPAID_SUBSCRIPTION",t.UNKNOWN="UNKNOWN"})(A||(A={}));var D;(function(t){t[t.UNKNOWN_SUBSCRIPTION_UPGRADE_DOWNGRADE_POLICY=0]="UNKNOWN_SUBSCRIPTION_UPGRADE_DOWNGRADE_POLICY",t[t.IMMEDIATE_WITH_TIME_PRORATION=1]="IMMEDIATE_WITH_TIME_PRORATION",t[t.IMMEDIATE_AND_CHARGE_PRORATED_PRICE=2]="IMMEDIATE_AND_CHARGE_PRORATED_PRICE",t[t.IMMEDIATE_WITHOUT_PRORATION=3]="IMMEDIATE_WITHOUT_PRORATION",t[t.DEFERRED=4]="DEFERRED",t[t.IMMEDIATE_AND_CHARGE_FULL_PRICE=5]="IMMEDIATE_AND_CHARGE_FULL_PRICE"})(D||(D={}));var W;(function(t){t[t.INFINITE_RECURRING=1]="INFINITE_RECURRING",t[t.FINITE_RECURRING=2]="FINITE_RECURRING",t[t.NON_RECURRING=3]="NON_RECURRING"})(W||(W={}));var C;(function(t){t.FREE_TRIAL="FREE_TRIAL",t.SINGLE_PAYMENT="SINGLE_PAYMENT",t.DISCOUNTED_RECURRING_PAYMENT="DISCOUNTED_RECURRING_PAYMENT"})(C||(C={}));var g;(function(t){t.DAY="DAY",t.WEEK="WEEK",t.MONTH="MONTH",t.YEAR="YEAR",t.UNKNOWN="UNKNOWN"})(g||(g={}));var y;(function(t){t.INAPP="inapp",t.SUBS="subs"})(y||(y={}));var F;(function(t){t[t.SUBSCRIPTIONS=0]="SUBSCRIPTIONS",t[t.SUBSCRIPTIONS_UPDATE=1]="SUBSCRIPTIONS_UPDATE",t[t.IN_APP_ITEMS_ON_VR=2]="IN_APP_ITEMS_ON_VR",t[t.SUBSCRIPTIONS_ON_VR=3]="SUBSCRIPTIONS_ON_VR",t[t.PRICE_CHANGE_CONFIRMATION=4]="PRICE_CHANGE_CONFIRMATION"})(F||(F={}));var P;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.USER_CANCELLED=1]="USER_CANCELLED",t[t.ERROR=2]="ERROR"})(P||(P={}));var G;(function(t){t.VERBOSE="VERBOSE",t.DEBUG="DEBUG",t.INFO="INFO",t.WARN="WARN",t.ERROR="ERROR"})(G||(G={}));var K;(function(t){t[t.BILLING_ISSUE=0]="BILLING_ISSUE",t[t.PRICE_INCREASE_CONSENT=1]="PRICE_INCREASE_CONSENT",t[t.GENERIC=2]="GENERIC"})(K||(K={}));var V;(function(t){t.DISABLED="DISABLED",t.INFORMATIONAL="INFORMATIONAL"})(V||(V={}));var m;(function(t){t.NOT_REQUESTED="NOT_REQUESTED",t.VERIFIED="VERIFIED",t.FAILED="FAILED",t.VERIFIED_ON_DEVICE="VERIFIED_ON_DEVICE"})(m||(m={}));var x;(function(t){t.NOT_PRESENTED="NOT_PRESENTED",t.ERROR="ERROR",t.CANCELLED="CANCELLED",t.PURCHASED="PURCHASED",t.RESTORED="RESTORED"})(x||(x={}));const J=Y("Purchases",{web:()=>X(()=>import("./web-DlnAG--z.js"),__vite__mapDeps([0,1,2])).then(t=>new t.PurchasesWeb)}),Q=()=>{var f,l,S,p,B;const{fetchProducts:t,fetchMyProducts:e,products:r,userProducts:I,user:N,attachProduct:o,cancelSubscription:i}=s.useContext(z.EscolaLMSContext),{t:a}=$(),E=s.useCallback(async()=>{try{await t({type:"subscription-all-in",pageSize:500})}catch(n){console.error("Error fetching subscriptions:",n),O(String(a("UnexpectedError")),"error")}},[t,a]),c=s.useCallback(async()=>{try{await e({type:"subscription-all-in",pageSize:500})}catch(n){console.error("Error fetching subscriptions:",n),O(String(a("UnexpectedError")),"error")}},[e,a]),w=s.useCallback(async n=>{try{await i(n)}catch(_){console.error("Error fetching subscriptions:",_),O(String(a("UnexpectedError")),"error")}},[a,i]),k=s.useMemo(()=>{var n,_,R;return(R=(n=r==null?void 0:r.list)==null?void 0:n.data)==null?void 0:R.reduce((L,U)=>L.price>U.price?U:L,(_=r==null?void 0:r.list)==null?void 0:_.data[0])},[(f=r==null?void 0:r.list)==null?void 0:f.data]),j=s.useMemo(()=>{var n,_;return(_=(n=I==null?void 0:I.list)==null?void 0:n.data)==null?void 0:_.find(R=>R==null?void 0:R.is_active)},[(l=I==null?void 0:I.list)==null?void 0:l.data]);return s.useEffect(()=>{var n;(n=N.value)!=null&&n.id&&c(),E()},[E,c,(S=N.value)==null?void 0:S.id]),{fetchSubscriptions:E,fetchMySubscriptions:c,userProducts:((p=I==null?void 0:I.list)==null?void 0:p.data)??[],subscriptions:((B=r==null?void 0:r.list)==null?void 0:B.data)??[],isLoading:r.loading,getCheapestSubscription:k,getActiveSubscription:j,attachProduct:o,subscriptionCancel:w}},Z=(t,e)=>{for(const r of t)if(r.product.identifier===e)return r.product;return null},H=t=>{var r,I,N,o,i,a,E,c;let e="";return u.getPlatform()==="ios"&&(e=((o=(N=(I=(r=t.product)==null?void 0:r.fields)==null?void 0:I.in_app_purchase_ids)==null?void 0:N.revenuecat)==null?void 0:o.app_store)||""),u.getPlatform()==="android"&&(e=((c=(E=(a=(i=t.product)==null?void 0:i.fields)==null?void 0:a.in_app_purchase_ids)==null?void 0:E.revenuecat)==null?void 0:c.play_store)||""),e},tt=t=>{var r,I,N,o,i,a;let e="";return u.getPlatform()==="ios"&&(e=((N=(I=(r=t==null?void 0:t.fields)==null?void 0:r.in_app_purchase_ids)==null?void 0:I.revenuecat)==null?void 0:N.app_store)||""),u.getPlatform()==="android"&&(e=((a=(i=(o=t==null?void 0:t.fields)==null?void 0:o.in_app_purchase_ids)==null?void 0:i.revenuecat)==null?void 0:a.play_store)||""),e},rt=t=>t.code?t.code===T.PURCHASE_CANCELLED_ERROR?null:O(d(`RevenuecatErrors.${Object.keys(T).find(e=>t.code===T[e])}`),"error"):O(`${d("UnexpectedError")}`,"error");export{J as P,P as R,m as V,tt as a,Z as f,H as g,rt as r,Q as u};
