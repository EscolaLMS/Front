import{D as T,H as q,b as U,ac as J,ad as A,ae as K,j as e,g as D,p as B,af as Q,N as X,ag as Y,q as Z,a as V,J as E,M as I,c as W,C as ss,L as es,f as ts,k as H}from"./index-YRlvC1Yo.js";import{r,R as P}from"./sentry-DZqhWugq.js";import{P as O}from"./index-DVY3CVpe.js";import{A as L,S as ns}from"./index.esm-B3QShECx.js";import{C as rs,a as is}from"./CourseAgenda-B7umAEmP.js";import"./katex-D1m830yy.js";import"./lodash-Bu-jC-fW.js";import"./Upload-DZLHwsT5.js";function z(s,t="/course/"){var b,M;const{sendProgress:n,getNextPrevTopic:a,progress:d,courseProgressDetails:l,fetchProgress:w}=r.useContext(T.EscolaLMSContext),[y,v]=r.useState(!1),{lessonID:m,topicID:j}=q(),{push:x}=U(),h=r.useMemo(()=>J((s==null?void 0:s.lessons)??[]),[s==null?void 0:s.lessons]),f=r.useMemo(()=>A((s==null?void 0:s.lessons)??[]),[s==null?void 0:s.lessons]),C=m?Number(m):(b=h==null?void 0:h[0])==null?void 0:b.id,c=j?Number(j):(M=f==null?void 0:f[0])==null?void 0:M.id;r.useEffect(()=>{c&&w()},[w,c]);const _=r.useMemo(()=>h.find(o=>o.id===C),[h,C]),u=r.useMemo(()=>f.find(o=>o.id===c),[f,c]),S=r.useMemo(()=>{var o;return((o=f.at(-1))==null?void 0:o.id)===(u==null?void 0:u.id)},[f,u==null?void 0:u.id]),k=r.useCallback(()=>{s.id&&n(s.id,[{topic_id:Number(c),status:1}]).then(()=>{const o=a(Number(c));o&&x(`${t}${s.id}/${o.lesson_id}/${o.id}`,null)})},[c,s,x,a,n,t]),i=r.useCallback(()=>{const o=a(Number(c),!1);if(s.id&&(u!=null&&u.can_skip)){n(s.id,[{topic_id:Number(c),status:1}]).then(()=>{o&&x(`${t}${s.id}/${o.lesson_id}/${o.id}`,null)});return}o&&x(`${t}${s.id}/${o.lesson_id}/${o.id}`,null)},[c,s,x,a,n,t,u]),p=r.useCallback((o=!0)=>{const g=a(Number(c),o);g&&x(`${t}${s.id}/${g==null?void 0:g.lesson_id}/${g==null?void 0:g.id}`)},[C,c,s,s.id,x,t]);return{topic:u,lesson:_,onNextTopic:k,onPrevTopic:i,getNextPrevTopic:a,isNextTopicButtonDisabled:y,disableNextTopicButton:v,onNextTopicPreview:p,sendProgress:n,progress:d,courseProgressDetails:l,isLastTopic:S}}const os=Z.aside`
  padding-bottom: 100px;
  .show-agenda-btn {
    width: 100%;
  }
  .agenda-wrapper {
    ${D&&Y`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      transform: translate(100%, 0);
      transition: transform 0.25s;
      overflow: scroll;
      padding: 40px 0 55px;
      z-index: 10;
      background-color: ${({theme:s})=>s.mode==="dark"?s.dm__background:s.background};
      &--visible {
        transform: translate(0, 0);
      }
      .hide-agenda-btn {
        display: block;
        margin: 0 15px 0 auto;
      }
    `}
  }
`,as=({course:s,topicId:t,onCompleteTopic:n,onCourseFinish:a})=>{var k;const{progress:d}=z(s),{courseProgressDetails:l,user:w,program:y}=r.useContext(T.EscolaLMSContext),v=r.useMemo(()=>y.value,[y.value]),m=r.useMemo(()=>(d.value??[]).find(({course:{id:i}})=>i===Number(s.id)),[d,s.id]),j=U(),[x,h]=r.useState(!1),f=((s==null?void 0:s.lessons)||[]).filter(i=>{var p;return(((p=i==null?void 0:i.topics)==null?void 0:p.length)??0)>0}),{topicIsFinished:C}=r.useContext(T.EscolaLMSContext),c=r.useMemo(()=>A(s.lessons??[]),[s.lessons]),_=r.useMemo(()=>{var p;const i=s.id;return l&&l.byId&&l.byId[Number(i)]&&l.byId[Number(i)].value?l.byId[Number(i)].value:d&&d.value&&((p=d.value.find(b=>b.course.id===Number(i)))==null?void 0:p.progress)},[d,s]),u=c.filter(i=>C(i.id)||(_==null?void 0:_.some(p=>p.topic_id===i.id&&p.status===1))).map(i=>i.id),S=r.useMemo(()=>{const i=((v==null?void 0:v.lessons)??[]).filter(N=>N.active_from===null||N.active_from&&K(new Date,new Date(N.active_from))),p=A(i),{incomplete:b,in_progress:M,complete:o}=p.reduce((N,F)=>{const $=((m==null?void 0:m.progress)??[]).find(({topic_id:G})=>G===F.id);if(!$)return N;const R={[L.CourseProgressItemElementStatus.INCOMPLETE]:"incomplete",[L.CourseProgressItemElementStatus.COMPLETE]:"complete",[L.CourseProgressItemElementStatus.IN_PROGRESS]:"in_progress"};return{...N,[R[$.status]]:[...N[R[$.status]],F.id]}},{in_progress:[],incomplete:[],complete:[]});if(M.length)return[...M,...o];const g=b!=null&&b[0]?[b[0]]:[];return[...o,...g]},[v==null?void 0:v.lessons,m==null?void 0:m.progress]);return!s&&!f?e.jsx(P.Fragment,{}):e.jsxs(os,{children:[D&&e.jsx(B.Button,{mode:"outline",className:"show-agenda-btn",onClick:()=>h(!0),children:Q("CourseProgram.ShowAgenda").toString()}),e.jsxs("div",{className:`${x?"agenda-wrapper agenda-wrapper--visible":"agenda-wrapper"}`,children:[D&&e.jsx(B.Button,{className:"hide-agenda-btn",mode:"secondary",onClick:()=>h(!1),children:"âœ•"}),e.jsx(rs.CourseAgenda,{areAllTopicsUnlocked:X(Number((k=w.value)==null?void 0:k.id),s),lessons:s.lessons,currentTopicId:t,finishedTopicIds:u,onMarkFinished:()=>n==null?void 0:n(),onTopicClick:i=>{j.push(`/course/${s.id}/${i.lesson_id}/${i.id}`),h(!1)},onCourseFinished:()=>a==null?void 0:a(),availableTopicsIds:S})]})]})},ds=({program:s})=>{var l;const{topic:t,lesson:n,onNextTopicPreview:a}=z(s,"/courses/preview/"),{t:d}=V();return r.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[t==null?void 0:t.id,n==null?void 0:n.id]),e.jsx(P.Fragment,{children:e.jsx("div",{className:"course-program course-program-page",children:e.jsx("div",{className:"course-program-container",children:e.jsxs("div",{className:"course-program-wrapper course-program-wrapper-preview",children:[e.jsxs("div",{className:"course-program-player",children:[e.jsxs("div",{className:"course-program-player-content",children:[e.jsx("h2",{children:t==null?void 0:t.title}),t&&t.introduction&&e.jsx(E.Col,{sm:12,md:12,lg:12,children:e.jsx("div",{className:"container-md",children:e.jsx(I.MarkdownRenderer,{children:t.introduction})})}),e.jsx("div",{className:"course-program-player-content__wrapper",style:{...((l=t==null?void 0:t.json)==null?void 0:l.wrapperStyle)||{}},children:e.jsx(is,{preview:!0,topic:t})})]}),e.jsxs(E.Row,{children:[n&&n.summary&&e.jsx(E.Col,{sm:12,md:12,lg:12,children:e.jsx("div",{className:"course-program-summary",children:e.jsx(I.MarkdownRenderer,{children:n.summary})})}),t&&t.summary&&e.jsx(E.Col,{sm:12,md:12,lg:12,children:e.jsx("div",{className:"course-program-summary",children:e.jsx(I.MarkdownRenderer,{children:t.summary})})})]}),e.jsx("div",{className:"course-program-player-next",children:e.jsxs("button",{className:"default-btn default-btn-equal",onClick:()=>a(),children:[e.jsxs("div",{className:"course-program-player-next-button__wrapper",children:[d("Next Topic")," >"]}),e.jsx("span",{})]})})]}),e.jsx(as,{course:s,topicId:Number(t==null?void 0:t.id)})]})})})})},ls=({program:s})=>{var v,m;const t=(m=(v=s==null?void 0:s.scorm)==null?void 0:v.scos)==null?void 0:m.find(j=>j.entry_url!==void 0),n=t==null?void 0:t.uuid,a=r.useRef(null),[d,l]=r.useState(0),w=610,{apiUrl:y}=r.useContext(W.EscolaLMSContext);return r.useEffect(()=>{var j,x,h,f;a.current&&l(((f=(h=(x=(j=a.current)==null?void 0:j.contentWindow)==null?void 0:x.document)==null?void 0:h.body)==null?void 0:f.scrollHeight)||0)},[a]),!t&&!n?e.jsx(P.Fragment,{}):e.jsx(P.Fragment,{children:e.jsx("div",{className:"container-fluid course-program",children:e.jsx("div",{className:"course-program-player scorm",style:{height:`${w+d}px`},children:n&&e.jsx(ns,{uuid:n,apiUrl:y,serviceWorkerUrl:"./service-worker-scorm.js"})})})})},js=()=>{var d,l;const{t:s}=V(),{id:t}=q(),{program:n,fetchProgram:a}=r.useContext(W.EscolaLMSContext);return r.useEffect(()=>{t&&a(Number(t))},[t,a]),n.loading?e.jsx(O,{}):n.error?e.jsx(ss,{children:e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("h4",{className:"alert-heading",children:s("Error")}),e.jsxs("p",{children:[" ",n.error.message||n.error.error]}),e.jsx("hr",{}),e.jsxs("p",{className:"mb-0",children:[s("CoursePage.Preview.SeeOther"),e.jsx(es,{to:ts.courses,children:s("Courses")}),"."]})]})}):n.value&&((l=(d=n==null?void 0:n.value)==null?void 0:d.scorm)!=null&&l.id)?e.jsx(H,{children:e.jsx(ls,{program:n.value})}):n.value&&n.value.lessons&&n.value.lessons.length?e.jsxs(H,{children:[e.jsx(ds,{program:n.value}),";"]}):e.jsx(O,{})};export{js as default};
//# sourceMappingURL=index-BjbYyW0e.js.map
