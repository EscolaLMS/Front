{"version":3,"file":"web-BEq7x4yT.js","sources":["../../node_modules/@firebase/installations/dist/esm/index.esm2017.js","../../node_modules/@firebase/messaging/dist/esm/index.esm2017.js","../../node_modules/@capacitor-firebase/messaging/dist/esm/web.js"],"sourcesContent":["import { _getProvider, getApp, _registerComponent, registerVersion } from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDB } from 'idb';\n\nconst name = \"@firebase/installations\";\nconst version = \"0.6.9\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst PENDING_TIMEOUT_MS = 10000;\r\nconst PACKAGE_VERSION = `w:${version}`;\r\nconst INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nconst INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nconst TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nconst SERVICE = 'installations';\r\nconst SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst ERROR_DESCRIPTION_MAP = {\r\n    [\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */]: 'Missing App configuration value: \"{$valueName}\"',\r\n    [\"not-registered\" /* ErrorCode.NOT_REGISTERED */]: 'Firebase Installation is not registered.',\r\n    [\"installation-not-found\" /* ErrorCode.INSTALLATION_NOT_FOUND */]: 'Firebase Installation not found.',\r\n    [\"request-failed\" /* ErrorCode.REQUEST_FAILED */]: '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    [\"app-offline\" /* ErrorCode.APP_OFFLINE */]: 'Could not process request. Application offline.',\r\n    [\"delete-pending-registration\" /* ErrorCode.DELETE_PENDING_REGISTRATION */]: \"Can't delete installation while there is a pending registration request.\"\r\n};\r\nconst ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* ErrorCode.REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint({ projectId }) {\r\n    return `${INSTALLATIONS_API_URL}/projects/${projectId}/installations`;\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* RequestStatus.COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nasync function getErrorFromResponse(requestName, response) {\r\n    const responseJson = await response.json();\r\n    const errorData = responseJson.error;\r\n    return ERROR_FACTORY.create(\"request-failed\" /* ErrorCode.REQUEST_FAILED */, {\r\n        requestName,\r\n        serverCode: errorData.code,\r\n        serverMessage: errorData.message,\r\n        serverStatus: errorData.status\r\n    });\r\n}\r\nfunction getHeaders({ apiKey }) {\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, { refreshToken }) {\r\n    const headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nasync function retryIfServerError(fn) {\r\n    const result = await fn();\r\n    if (result.status >= 500 && result.status < 600) {\r\n        // Internal Server Error. Retry request.\r\n        return fn();\r\n    }\r\n    return result;\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return `${INTERNAL_AUTH_VERSION} ${refreshToken}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function createInstallationRequest({ appConfig, heartbeatServiceProvider }, { fid }) {\r\n    const endpoint = getInstallationsEndpoint(appConfig);\r\n    const headers = getHeaders(appConfig);\r\n    // If heartbeat service exists, add the heartbeat string to the header.\r\n    const heartbeatService = heartbeatServiceProvider.getImmediate({\r\n        optional: true\r\n    });\r\n    if (heartbeatService) {\r\n        const heartbeatsHeader = await heartbeatService.getHeartbeatsHeader();\r\n        if (heartbeatsHeader) {\r\n            headers.append('x-firebase-client', heartbeatsHeader);\r\n        }\r\n    }\r\n    const body = {\r\n        fid,\r\n        authVersion: INTERNAL_AUTH_VERSION,\r\n        appId: appConfig.appId,\r\n        sdkVersion: PACKAGE_VERSION\r\n    };\r\n    const request = {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    const response = await retryIfServerError(() => fetch(endpoint, request));\r\n    if (response.ok) {\r\n        const responseValue = await response.json();\r\n        const registeredInstallationEntry = {\r\n            fid: responseValue.fid || fid,\r\n            registrationStatus: 2 /* RequestStatus.COMPLETED */,\r\n            refreshToken: responseValue.refreshToken,\r\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n        };\r\n        return registeredInstallationEntry;\r\n    }\r\n    else {\r\n        throw await getErrorFromResponse('Create Installation', response);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(resolve => {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    const b64 = btoa(String.fromCharCode(...array));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nconst INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        const fidByteArray = new Uint8Array(17);\r\n        const crypto = self.crypto || self.msCrypto;\r\n        crypto.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 0b01110000 + (fidByteArray[0] % 0b00010000);\r\n        const fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    const b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return `${appConfig.appName}!${appConfig.appId}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    const key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    const key = getKey(appConfig);\r\n    let callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    const key = getKey(appConfig);\r\n    const callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    const callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    for (const callback of callbacks) {\r\n        callback(fid);\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    const channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key, fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nlet broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = e => {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DATABASE_NAME = 'firebase-installations-database';\r\nconst DATABASE_VERSION = 1;\r\nconst OBJECT_STORE_NAME = 'firebase-installations-store';\r\nlet dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDB(DATABASE_NAME, DATABASE_VERSION, {\r\n            upgrade: (db, oldVersion) => {\r\n                // We don't use 'break' in this switch statement, the fall-through\r\n                // behavior is what we want, because if there are multiple versions between\r\n                // the old version and the current version, we want ALL the migrations\r\n                // that correspond to those versions to run, not only the last one.\r\n                // eslint-disable-next-line default-case\r\n                switch (oldVersion) {\r\n                    case 0:\r\n                        db.createObjectStore(OBJECT_STORE_NAME);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nasync function set(appConfig, value) {\r\n    const key = getKey(appConfig);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    const objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n    const oldValue = (await objectStore.get(key));\r\n    await objectStore.put(value, key);\r\n    await tx.done;\r\n    if (!oldValue || oldValue.fid !== value.fid) {\r\n        fidChanged(appConfig, value.fid);\r\n    }\r\n    return value;\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nasync function remove(appConfig) {\r\n    const key = getKey(appConfig);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    await tx.objectStore(OBJECT_STORE_NAME).delete(key);\r\n    await tx.done;\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nasync function update(appConfig, updateFn) {\r\n    const key = getKey(appConfig);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    const store = tx.objectStore(OBJECT_STORE_NAME);\r\n    const oldValue = (await store.get(key));\r\n    const newValue = updateFn(oldValue);\r\n    if (newValue === undefined) {\r\n        await store.delete(key);\r\n    }\r\n    else {\r\n        await store.put(newValue, key);\r\n    }\r\n    await tx.done;\r\n    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n        fidChanged(appConfig, newValue.fid);\r\n    }\r\n    return newValue;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nasync function getInstallationEntry(installations) {\r\n    let registrationPromise;\r\n    const installationEntry = await update(installations.appConfig, oldEntry => {\r\n        const installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n        const entryWithPromise = triggerRegistrationIfNecessary(installations, installationEntry);\r\n        registrationPromise = entryWithPromise.registrationPromise;\r\n        return entryWithPromise.installationEntry;\r\n    });\r\n    if (installationEntry.fid === INVALID_FID) {\r\n        // FID generation failed. Waiting for the FID from the server.\r\n        return { installationEntry: await registrationPromise };\r\n    }\r\n    return {\r\n        installationEntry,\r\n        registrationPromise\r\n    };\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    const entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* RequestStatus.NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(installations, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* RequestStatus.NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            const registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* ErrorCode.APP_OFFLINE */));\r\n            return {\r\n                installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        const inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* RequestStatus.IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        const registrationPromise = registerInstallation(installations, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */) {\r\n        return {\r\n            installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(installations)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nasync function registerInstallation(installations, installationEntry) {\r\n    try {\r\n        const registeredInstallationEntry = await createInstallationRequest(installations, installationEntry);\r\n        return set(installations.appConfig, registeredInstallationEntry);\r\n    }\r\n    catch (e) {\r\n        if (isServerError(e) && e.customData.serverCode === 409) {\r\n            // Server returned a \"FID cannot be used\" error.\r\n            // Generate a new ID next time.\r\n            await remove(installations.appConfig);\r\n        }\r\n        else {\r\n            // Registration failed. Set FID as not registered.\r\n            await set(installations.appConfig, {\r\n                fid: installationEntry.fid,\r\n                registrationStatus: 0 /* RequestStatus.NOT_STARTED */\r\n            });\r\n        }\r\n        throw e;\r\n    }\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nasync function waitUntilFidRegistration(installations) {\r\n    // Unfortunately, there is no way of reliably observing when a value in\r\n    // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\r\n    // so we need to poll.\r\n    let entry = await updateInstallationRequest(installations.appConfig);\r\n    while (entry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */) {\r\n        // createInstallation request still in progress.\r\n        await sleep(100);\r\n        entry = await updateInstallationRequest(installations.appConfig);\r\n    }\r\n    if (entry.registrationStatus === 0 /* RequestStatus.NOT_STARTED */) {\r\n        // The request timed out or failed in a different call. Try again.\r\n        const { installationEntry, registrationPromise } = await getInstallationEntry(installations);\r\n        if (registrationPromise) {\r\n            return registrationPromise;\r\n        }\r\n        else {\r\n            // if there is no registrationPromise, entry is registered.\r\n            return installationEntry;\r\n        }\r\n    }\r\n    return entry;\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, oldEntry => {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* ErrorCode.INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* RequestStatus.NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function generateAuthTokenRequest({ appConfig, heartbeatServiceProvider }, installationEntry) {\r\n    const endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n    const headers = getHeadersWithAuth(appConfig, installationEntry);\r\n    // If heartbeat service exists, add the heartbeat string to the header.\r\n    const heartbeatService = heartbeatServiceProvider.getImmediate({\r\n        optional: true\r\n    });\r\n    if (heartbeatService) {\r\n        const heartbeatsHeader = await heartbeatService.getHeartbeatsHeader();\r\n        if (heartbeatsHeader) {\r\n            headers.append('x-firebase-client', heartbeatsHeader);\r\n        }\r\n    }\r\n    const body = {\r\n        installation: {\r\n            sdkVersion: PACKAGE_VERSION,\r\n            appId: appConfig.appId\r\n        }\r\n    };\r\n    const request = {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    const response = await retryIfServerError(() => fetch(endpoint, request));\r\n    if (response.ok) {\r\n        const responseValue = await response.json();\r\n        const completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n        return completedAuthToken;\r\n    }\r\n    else {\r\n        throw await getErrorFromResponse('Generate Auth Token', response);\r\n    }\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, { fid }) {\r\n    return `${getInstallationsEndpoint(appConfig)}/${fid}/authTokens:generate`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nasync function refreshAuthToken(installations, forceRefresh = false) {\r\n    let tokenPromise;\r\n    const entry = await update(installations.appConfig, oldEntry => {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* ErrorCode.NOT_REGISTERED */);\r\n        }\r\n        const oldAuthToken = oldEntry.authToken;\r\n        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n            // There is a valid token in the DB.\r\n            return oldEntry;\r\n        }\r\n        else if (oldAuthToken.requestStatus === 1 /* RequestStatus.IN_PROGRESS */) {\r\n            // There already is a token request in progress.\r\n            tokenPromise = waitUntilAuthTokenRequest(installations, forceRefresh);\r\n            return oldEntry;\r\n        }\r\n        else {\r\n            // No token or token expired.\r\n            if (!navigator.onLine) {\r\n                throw ERROR_FACTORY.create(\"app-offline\" /* ErrorCode.APP_OFFLINE */);\r\n            }\r\n            const inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n            tokenPromise = fetchAuthTokenFromServer(installations, inProgressEntry);\r\n            return inProgressEntry;\r\n        }\r\n    });\r\n    const authToken = tokenPromise\r\n        ? await tokenPromise\r\n        : entry.authToken;\r\n    return authToken;\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nasync function waitUntilAuthTokenRequest(installations, forceRefresh) {\r\n    // Unfortunately, there is no way of reliably observing when a value in\r\n    // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\r\n    // so we need to poll.\r\n    let entry = await updateAuthTokenRequest(installations.appConfig);\r\n    while (entry.authToken.requestStatus === 1 /* RequestStatus.IN_PROGRESS */) {\r\n        // generateAuthToken still in progress.\r\n        await sleep(100);\r\n        entry = await updateAuthTokenRequest(installations.appConfig);\r\n    }\r\n    const authToken = entry.authToken;\r\n    if (authToken.requestStatus === 0 /* RequestStatus.NOT_STARTED */) {\r\n        // The request timed out or failed in a different call. Try again.\r\n        return refreshAuthToken(installations, forceRefresh);\r\n    }\r\n    else {\r\n        return authToken;\r\n    }\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, oldEntry => {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* ErrorCode.NOT_REGISTERED */);\r\n        }\r\n        const oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return Object.assign(Object.assign({}, oldEntry), { authToken: { requestStatus: 0 /* RequestStatus.NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nasync function fetchAuthTokenFromServer(installations, installationEntry) {\r\n    try {\r\n        const authToken = await generateAuthTokenRequest(installations, installationEntry);\r\n        const updatedInstallationEntry = Object.assign(Object.assign({}, installationEntry), { authToken });\r\n        await set(installations.appConfig, updatedInstallationEntry);\r\n        return authToken;\r\n    }\r\n    catch (e) {\r\n        if (isServerError(e) &&\r\n            (e.customData.serverCode === 401 || e.customData.serverCode === 404)) {\r\n            // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n            // Generate a new ID next time.\r\n            await remove(installations.appConfig);\r\n        }\r\n        else {\r\n            const updatedInstallationEntry = Object.assign(Object.assign({}, installationEntry), { authToken: { requestStatus: 0 /* RequestStatus.NOT_STARTED */ } });\r\n            await set(installations.appConfig, updatedInstallationEntry);\r\n        }\r\n        throw e;\r\n    }\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* RequestStatus.COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* RequestStatus.COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    const now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    const inProgressAuthToken = {\r\n        requestStatus: 1 /* RequestStatus.IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return Object.assign(Object.assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* RequestStatus.IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Creates a Firebase Installation if there isn't one for the app and\r\n * returns the Installation ID.\r\n * @param installations - The `Installations` instance.\r\n *\r\n * @public\r\n */\r\nasync function getId(installations) {\r\n    const installationsImpl = installations;\r\n    const { installationEntry, registrationPromise } = await getInstallationEntry(installationsImpl);\r\n    if (registrationPromise) {\r\n        registrationPromise.catch(console.error);\r\n    }\r\n    else {\r\n        // If the installation is already registered, update the authentication\r\n        // token if needed.\r\n        refreshAuthToken(installationsImpl).catch(console.error);\r\n    }\r\n    return installationEntry.fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a Firebase Installations auth token, identifying the current\r\n * Firebase Installation.\r\n * @param installations - The `Installations` instance.\r\n * @param forceRefresh - Force refresh regardless of token expiration.\r\n *\r\n * @public\r\n */\r\nasync function getToken(installations, forceRefresh = false) {\r\n    const installationsImpl = installations;\r\n    await completeInstallationRegistration(installationsImpl);\r\n    // At this point we either have a Registered Installation in the DB, or we've\r\n    // already thrown an error.\r\n    const authToken = await refreshAuthToken(installationsImpl, forceRefresh);\r\n    return authToken.token;\r\n}\r\nasync function completeInstallationRegistration(installations) {\r\n    const { registrationPromise } = await getInstallationEntry(installations);\r\n    if (registrationPromise) {\r\n        // A createInstallation request is in progress. Wait until it finishes.\r\n        await registrationPromise;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function deleteInstallationRequest(appConfig, installationEntry) {\r\n    const endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n    const headers = getHeadersWithAuth(appConfig, installationEntry);\r\n    const request = {\r\n        method: 'DELETE',\r\n        headers\r\n    };\r\n    const response = await retryIfServerError(() => fetch(endpoint, request));\r\n    if (!response.ok) {\r\n        throw await getErrorFromResponse('Delete Installation', response);\r\n    }\r\n}\r\nfunction getDeleteEndpoint(appConfig, { fid }) {\r\n    return `${getInstallationsEndpoint(appConfig)}/${fid}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Deletes the Firebase Installation and all associated data.\r\n * @param installations - The `Installations` instance.\r\n *\r\n * @public\r\n */\r\nasync function deleteInstallations(installations) {\r\n    const { appConfig } = installations;\r\n    const entry = await update(appConfig, oldEntry => {\r\n        if (oldEntry && oldEntry.registrationStatus === 0 /* RequestStatus.NOT_STARTED */) {\r\n            // Delete the unregistered entry without sending a deleteInstallation request.\r\n            return undefined;\r\n        }\r\n        return oldEntry;\r\n    });\r\n    if (entry) {\r\n        if (entry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */) {\r\n            // Can't delete while trying to register.\r\n            throw ERROR_FACTORY.create(\"delete-pending-registration\" /* ErrorCode.DELETE_PENDING_REGISTRATION */);\r\n        }\r\n        else if (entry.registrationStatus === 2 /* RequestStatus.COMPLETED */) {\r\n            if (!navigator.onLine) {\r\n                throw ERROR_FACTORY.create(\"app-offline\" /* ErrorCode.APP_OFFLINE */);\r\n            }\r\n            else {\r\n                await deleteInstallationRequest(appConfig, entry);\r\n                await remove(appConfig);\r\n            }\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n * @param installations - The `Installations` instance.\r\n * @param callback - The callback function that is invoked when FID changes.\r\n * @returns A function that can be called to unsubscribe.\r\n *\r\n * @public\r\n */\r\nfunction onIdChange(installations, callback) {\r\n    const { appConfig } = installations;\r\n    addCallback(appConfig, callback);\r\n    return () => {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns an instance of {@link Installations} associated with the given\r\n * {@link @firebase/app#FirebaseApp} instance.\r\n * @param app - The {@link @firebase/app#FirebaseApp} instance.\r\n *\r\n * @public\r\n */\r\nfunction getInstallations(app = getApp()) {\r\n    const installationsImpl = _getProvider(app, 'installations').getImmediate();\r\n    return installationsImpl;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    const configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    for (const keyName of configKeys) {\r\n        if (!app.options[keyName]) {\r\n            throw getMissingValueError(keyName);\r\n        }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */, {\r\n        valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst INSTALLATIONS_NAME = 'installations';\r\nconst INSTALLATIONS_NAME_INTERNAL = 'installations-internal';\r\nconst publicFactory = (container) => {\r\n    const app = container.getProvider('app').getImmediate();\r\n    // Throws if app isn't configured properly.\r\n    const appConfig = extractAppConfig(app);\r\n    const heartbeatServiceProvider = _getProvider(app, 'heartbeat');\r\n    const installationsImpl = {\r\n        app,\r\n        appConfig,\r\n        heartbeatServiceProvider,\r\n        _delete: () => Promise.resolve()\r\n    };\r\n    return installationsImpl;\r\n};\r\nconst internalFactory = (container) => {\r\n    const app = container.getProvider('app').getImmediate();\r\n    // Internal FIS instance relies on public FIS instance.\r\n    const installations = _getProvider(app, INSTALLATIONS_NAME).getImmediate();\r\n    const installationsInternal = {\r\n        getId: () => getId(installations),\r\n        getToken: (forceRefresh) => getToken(installations, forceRefresh)\r\n    };\r\n    return installationsInternal;\r\n};\r\nfunction registerInstallations() {\r\n    _registerComponent(new Component(INSTALLATIONS_NAME, publicFactory, \"PUBLIC\" /* ComponentType.PUBLIC */));\r\n    _registerComponent(new Component(INSTALLATIONS_NAME_INTERNAL, internalFactory, \"PRIVATE\" /* ComponentType.PRIVATE */));\r\n}\n\n/**\r\n * The Firebase Installations Web SDK.\r\n * This SDK does not work in a Node.js environment.\r\n *\r\n * @packageDocumentation\r\n */\r\nregisterInstallations();\r\nregisterVersion(name, version);\r\n// BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\nregisterVersion(name, version, 'esm2017');\n\nexport { deleteInstallations, getId, getInstallations, getToken, onIdChange };\n//# sourceMappingURL=index.esm2017.js.map\n","import '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { openDB, deleteDB } from 'idb';\nimport { ErrorFactory, validateIndexedDBOpenable, isIndexedDBAvailable, areCookiesEnabled, getModularInstance } from '@firebase/util';\nimport { _registerComponent, registerVersion, _getProvider, getApp } from '@firebase/app';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nconst DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\r\nconst DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\r\nconst ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\nconst CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\r\nconst CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\r\nconst CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\r\n/** Set to '1' if Analytics is enabled for the campaign */\r\nconst CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\r\nvar MessageType$1;\r\n(function (MessageType) {\r\n    MessageType[MessageType[\"DATA_MESSAGE\"] = 1] = \"DATA_MESSAGE\";\r\n    MessageType[MessageType[\"DISPLAY_NOTIFICATION\"] = 3] = \"DISPLAY_NOTIFICATION\";\r\n})(MessageType$1 || (MessageType$1 = {}));\n\n/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\r\n * in compliance with the License. You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software distributed under the License\r\n * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\r\n * or implied. See the License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction arrayToBase64(array) {\r\n    const uint8Array = new Uint8Array(array);\r\n    const base64String = btoa(String.fromCharCode(...uint8Array));\r\n    return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\r\nfunction base64ToArray(base64String) {\r\n    const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    const base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    const rawData = atob(base64);\r\n    const outputArray = new Uint8Array(rawData.length);\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst OLD_DB_NAME = 'fcm_token_details_db';\r\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\r\n * callback is called for all versions of the old DB.\r\n */\r\nconst OLD_DB_VERSION = 5;\r\nconst OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nasync function migrateOldDatabase(senderId) {\r\n    if ('databases' in indexedDB) {\r\n        // indexedDb.databases() is an IndexedDB v3 API and does not exist in all browsers. TODO: Remove\r\n        // typecast when it lands in TS types.\r\n        const databases = await indexedDB.databases();\r\n        const dbNames = databases.map(db => db.name);\r\n        if (!dbNames.includes(OLD_DB_NAME)) {\r\n            // old DB didn't exist, no need to open.\r\n            return null;\r\n        }\r\n    }\r\n    let tokenDetails = null;\r\n    const db = await openDB(OLD_DB_NAME, OLD_DB_VERSION, {\r\n        upgrade: async (db, oldVersion, newVersion, upgradeTransaction) => {\r\n            var _a;\r\n            if (oldVersion < 2) {\r\n                // Database too old, skip migration.\r\n                return;\r\n            }\r\n            if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n                // Database did not exist. Nothing to do.\r\n                return;\r\n            }\r\n            const objectStore = upgradeTransaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n            const value = await objectStore.index('fcmSenderId').get(senderId);\r\n            await objectStore.clear();\r\n            if (!value) {\r\n                // No entry in the database, nothing to migrate.\r\n                return;\r\n            }\r\n            if (oldVersion === 2) {\r\n                const oldDetails = value;\r\n                if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\r\n                    return;\r\n                }\r\n                tokenDetails = {\r\n                    token: oldDetails.fcmToken,\r\n                    createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\r\n                    subscriptionOptions: {\r\n                        auth: oldDetails.auth,\r\n                        p256dh: oldDetails.p256dh,\r\n                        endpoint: oldDetails.endpoint,\r\n                        swScope: oldDetails.swScope,\r\n                        vapidKey: typeof oldDetails.vapidKey === 'string'\r\n                            ? oldDetails.vapidKey\r\n                            : arrayToBase64(oldDetails.vapidKey)\r\n                    }\r\n                };\r\n            }\r\n            else if (oldVersion === 3) {\r\n                const oldDetails = value;\r\n                tokenDetails = {\r\n                    token: oldDetails.fcmToken,\r\n                    createTime: oldDetails.createTime,\r\n                    subscriptionOptions: {\r\n                        auth: arrayToBase64(oldDetails.auth),\r\n                        p256dh: arrayToBase64(oldDetails.p256dh),\r\n                        endpoint: oldDetails.endpoint,\r\n                        swScope: oldDetails.swScope,\r\n                        vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                    }\r\n                };\r\n            }\r\n            else if (oldVersion === 4) {\r\n                const oldDetails = value;\r\n                tokenDetails = {\r\n                    token: oldDetails.fcmToken,\r\n                    createTime: oldDetails.createTime,\r\n                    subscriptionOptions: {\r\n                        auth: arrayToBase64(oldDetails.auth),\r\n                        p256dh: arrayToBase64(oldDetails.p256dh),\r\n                        endpoint: oldDetails.endpoint,\r\n                        swScope: oldDetails.swScope,\r\n                        vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    });\r\n    db.close();\r\n    // Delete all old databases.\r\n    await deleteDB(OLD_DB_NAME);\r\n    await deleteDB('fcm_vapid_details_db');\r\n    await deleteDB('undefined');\r\n    return checkTokenDetails(tokenDetails) ? tokenDetails : null;\r\n}\r\nfunction checkTokenDetails(tokenDetails) {\r\n    if (!tokenDetails || !tokenDetails.subscriptionOptions) {\r\n        return false;\r\n    }\r\n    const { subscriptionOptions } = tokenDetails;\r\n    return (typeof tokenDetails.createTime === 'number' &&\r\n        tokenDetails.createTime > 0 &&\r\n        typeof tokenDetails.token === 'string' &&\r\n        tokenDetails.token.length > 0 &&\r\n        typeof subscriptionOptions.auth === 'string' &&\r\n        subscriptionOptions.auth.length > 0 &&\r\n        typeof subscriptionOptions.p256dh === 'string' &&\r\n        subscriptionOptions.p256dh.length > 0 &&\r\n        typeof subscriptionOptions.endpoint === 'string' &&\r\n        subscriptionOptions.endpoint.length > 0 &&\r\n        typeof subscriptionOptions.swScope === 'string' &&\r\n        subscriptionOptions.swScope.length > 0 &&\r\n        typeof subscriptionOptions.vapidKey === 'string' &&\r\n        subscriptionOptions.vapidKey.length > 0);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Exported for tests.\r\nconst DATABASE_NAME = 'firebase-messaging-database';\r\nconst DATABASE_VERSION = 1;\r\nconst OBJECT_STORE_NAME = 'firebase-messaging-store';\r\nlet dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDB(DATABASE_NAME, DATABASE_VERSION, {\r\n            upgrade: (upgradeDb, oldVersion) => {\r\n                // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\r\n                // because if there are multiple versions between the old version and the current version, we\r\n                // want ALL the migrations that correspond to those versions to run, not only the last one.\r\n                // eslint-disable-next-line default-case\r\n                switch (oldVersion) {\r\n                    case 0:\r\n                        upgradeDb.createObjectStore(OBJECT_STORE_NAME);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Gets record(s) from the objectStore that match the given key. */\r\nasync function dbGet(firebaseDependencies) {\r\n    const key = getKey(firebaseDependencies);\r\n    const db = await getDbPromise();\r\n    const tokenDetails = (await db\r\n        .transaction(OBJECT_STORE_NAME)\r\n        .objectStore(OBJECT_STORE_NAME)\r\n        .get(key));\r\n    if (tokenDetails) {\r\n        return tokenDetails;\r\n    }\r\n    else {\r\n        // Check if there is a tokenDetails object in the old DB.\r\n        const oldTokenDetails = await migrateOldDatabase(firebaseDependencies.appConfig.senderId);\r\n        if (oldTokenDetails) {\r\n            await dbSet(firebaseDependencies, oldTokenDetails);\r\n            return oldTokenDetails;\r\n        }\r\n    }\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nasync function dbSet(firebaseDependencies, tokenDetails) {\r\n    const key = getKey(firebaseDependencies);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    await tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key);\r\n    await tx.done;\r\n    return tokenDetails;\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nasync function dbRemove(firebaseDependencies) {\r\n    const key = getKey(firebaseDependencies);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    await tx.objectStore(OBJECT_STORE_NAME).delete(key);\r\n    await tx.done;\r\n}\r\nfunction getKey({ appConfig }) {\r\n    return appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst ERROR_MAP = {\r\n    [\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */]: 'Missing App configuration value: \"{$valueName}\"',\r\n    [\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */]: 'This method is available in a Window context.',\r\n    [\"only-available-in-sw\" /* ErrorCode.AVAILABLE_IN_SW */]: 'This method is available in a service worker context.',\r\n    [\"permission-default\" /* ErrorCode.PERMISSION_DEFAULT */]: 'The notification permission was not granted and dismissed instead.',\r\n    [\"permission-blocked\" /* ErrorCode.PERMISSION_BLOCKED */]: 'The notification permission was not granted and blocked instead.',\r\n    [\"unsupported-browser\" /* ErrorCode.UNSUPPORTED_BROWSER */]: \"This browser doesn't support the API's required to use the Firebase SDK.\",\r\n    [\"indexed-db-unsupported\" /* ErrorCode.INDEXED_DB_UNSUPPORTED */]: \"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)\",\r\n    [\"failed-service-worker-registration\" /* ErrorCode.FAILED_DEFAULT_REGISTRATION */]: 'We are unable to register the default service worker. {$browserErrorMessage}',\r\n    [\"token-subscribe-failed\" /* ErrorCode.TOKEN_SUBSCRIBE_FAILED */]: 'A problem occurred while subscribing the user to FCM: {$errorInfo}',\r\n    [\"token-subscribe-no-token\" /* ErrorCode.TOKEN_SUBSCRIBE_NO_TOKEN */]: 'FCM returned no token when subscribing the user to push.',\r\n    [\"token-unsubscribe-failed\" /* ErrorCode.TOKEN_UNSUBSCRIBE_FAILED */]: 'A problem occurred while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    [\"token-update-failed\" /* ErrorCode.TOKEN_UPDATE_FAILED */]: 'A problem occurred while updating the user from FCM: {$errorInfo}',\r\n    [\"token-update-no-token\" /* ErrorCode.TOKEN_UPDATE_NO_TOKEN */]: 'FCM returned no token when updating the user to push.',\r\n    [\"use-sw-after-get-token\" /* ErrorCode.USE_SW_AFTER_GET_TOKEN */]: 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    [\"invalid-sw-registration\" /* ErrorCode.INVALID_SW_REGISTRATION */]: 'The input to useServiceWorker() must be a ServiceWorkerRegistration.',\r\n    [\"invalid-bg-handler\" /* ErrorCode.INVALID_BG_HANDLER */]: 'The input to setBackgroundMessageHandler() must be a function.',\r\n    [\"invalid-vapid-key\" /* ErrorCode.INVALID_VAPID_KEY */]: 'The public VAPID key must be a string.',\r\n    [\"use-vapid-key-after-get-token\" /* ErrorCode.USE_VAPID_KEY_AFTER_GET_TOKEN */]: 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.'\r\n};\r\nconst ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function requestGetToken(firebaseDependencies, subscriptionOptions) {\r\n    const headers = await getHeaders(firebaseDependencies);\r\n    const body = getBody(subscriptionOptions);\r\n    const subscribeOptions = {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    let responseData;\r\n    try {\r\n        const response = await fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions);\r\n        responseData = await response.json();\r\n    }\r\n    catch (err) {\r\n        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* ErrorCode.TOKEN_SUBSCRIBE_FAILED */, {\r\n            errorInfo: err === null || err === void 0 ? void 0 : err.toString()\r\n        });\r\n    }\r\n    if (responseData.error) {\r\n        const message = responseData.error.message;\r\n        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* ErrorCode.TOKEN_SUBSCRIBE_FAILED */, {\r\n            errorInfo: message\r\n        });\r\n    }\r\n    if (!responseData.token) {\r\n        throw ERROR_FACTORY.create(\"token-subscribe-no-token\" /* ErrorCode.TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n    }\r\n    return responseData.token;\r\n}\r\nasync function requestUpdateToken(firebaseDependencies, tokenDetails) {\r\n    const headers = await getHeaders(firebaseDependencies);\r\n    const body = getBody(tokenDetails.subscriptionOptions);\r\n    const updateOptions = {\r\n        method: 'PATCH',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    let responseData;\r\n    try {\r\n        const response = await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${tokenDetails.token}`, updateOptions);\r\n        responseData = await response.json();\r\n    }\r\n    catch (err) {\r\n        throw ERROR_FACTORY.create(\"token-update-failed\" /* ErrorCode.TOKEN_UPDATE_FAILED */, {\r\n            errorInfo: err === null || err === void 0 ? void 0 : err.toString()\r\n        });\r\n    }\r\n    if (responseData.error) {\r\n        const message = responseData.error.message;\r\n        throw ERROR_FACTORY.create(\"token-update-failed\" /* ErrorCode.TOKEN_UPDATE_FAILED */, {\r\n            errorInfo: message\r\n        });\r\n    }\r\n    if (!responseData.token) {\r\n        throw ERROR_FACTORY.create(\"token-update-no-token\" /* ErrorCode.TOKEN_UPDATE_NO_TOKEN */);\r\n    }\r\n    return responseData.token;\r\n}\r\nasync function requestDeleteToken(firebaseDependencies, token) {\r\n    const headers = await getHeaders(firebaseDependencies);\r\n    const unsubscribeOptions = {\r\n        method: 'DELETE',\r\n        headers\r\n    };\r\n    try {\r\n        const response = await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${token}`, unsubscribeOptions);\r\n        const responseData = await response.json();\r\n        if (responseData.error) {\r\n            const message = responseData.error.message;\r\n            throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* ErrorCode.TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                errorInfo: message\r\n            });\r\n        }\r\n    }\r\n    catch (err) {\r\n        throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* ErrorCode.TOKEN_UNSUBSCRIBE_FAILED */, {\r\n            errorInfo: err === null || err === void 0 ? void 0 : err.toString()\r\n        });\r\n    }\r\n}\r\nfunction getEndpoint({ projectId }) {\r\n    return `${ENDPOINT}/projects/${projectId}/registrations`;\r\n}\r\nasync function getHeaders({ appConfig, installations }) {\r\n    const authToken = await installations.getToken();\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': appConfig.apiKey,\r\n        'x-goog-firebase-installations-auth': `FIS ${authToken}`\r\n    });\r\n}\r\nfunction getBody({ p256dh, auth, endpoint, vapidKey }) {\r\n    const body = {\r\n        web: {\r\n            endpoint,\r\n            auth,\r\n            p256dh\r\n        }\r\n    };\r\n    if (vapidKey !== DEFAULT_VAPID_KEY) {\r\n        body.web.applicationPubKey = vapidKey;\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// UpdateRegistration will be called once every week.\r\nconst TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nasync function getTokenInternal(messaging) {\r\n    const pushSubscription = await getPushSubscription(messaging.swRegistration, messaging.vapidKey);\r\n    const subscriptionOptions = {\r\n        vapidKey: messaging.vapidKey,\r\n        swScope: messaging.swRegistration.scope,\r\n        endpoint: pushSubscription.endpoint,\r\n        auth: arrayToBase64(pushSubscription.getKey('auth')),\r\n        p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\r\n    };\r\n    const tokenDetails = await dbGet(messaging.firebaseDependencies);\r\n    if (!tokenDetails) {\r\n        // No token, get a new one.\r\n        return getNewToken(messaging.firebaseDependencies, subscriptionOptions);\r\n    }\r\n    else if (!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) {\r\n        // Invalid token, get a new one.\r\n        try {\r\n            await requestDeleteToken(messaging.firebaseDependencies, tokenDetails.token);\r\n        }\r\n        catch (e) {\r\n            // Suppress errors because of #2364\r\n            console.warn(e);\r\n        }\r\n        return getNewToken(messaging.firebaseDependencies, subscriptionOptions);\r\n    }\r\n    else if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\r\n        // Weekly token refresh\r\n        return updateToken(messaging, {\r\n            token: tokenDetails.token,\r\n            createTime: Date.now(),\r\n            subscriptionOptions\r\n        });\r\n    }\r\n    else {\r\n        // Valid token, nothing to do.\r\n        return tokenDetails.token;\r\n    }\r\n}\r\n/**\r\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\r\n * the push subscription if it exists.\r\n */\r\nasync function deleteTokenInternal(messaging) {\r\n    const tokenDetails = await dbGet(messaging.firebaseDependencies);\r\n    if (tokenDetails) {\r\n        await requestDeleteToken(messaging.firebaseDependencies, tokenDetails.token);\r\n        await dbRemove(messaging.firebaseDependencies);\r\n    }\r\n    // Unsubscribe from the push subscription.\r\n    const pushSubscription = await messaging.swRegistration.pushManager.getSubscription();\r\n    if (pushSubscription) {\r\n        return pushSubscription.unsubscribe();\r\n    }\r\n    // If there's no SW, consider it a success.\r\n    return true;\r\n}\r\nasync function updateToken(messaging, tokenDetails) {\r\n    try {\r\n        const updatedToken = await requestUpdateToken(messaging.firebaseDependencies, tokenDetails);\r\n        const updatedTokenDetails = Object.assign(Object.assign({}, tokenDetails), { token: updatedToken, createTime: Date.now() });\r\n        await dbSet(messaging.firebaseDependencies, updatedTokenDetails);\r\n        return updatedToken;\r\n    }\r\n    catch (e) {\r\n        throw e;\r\n    }\r\n}\r\nasync function getNewToken(firebaseDependencies, subscriptionOptions) {\r\n    const token = await requestGetToken(firebaseDependencies, subscriptionOptions);\r\n    const tokenDetails = {\r\n        token,\r\n        createTime: Date.now(),\r\n        subscriptionOptions\r\n    };\r\n    await dbSet(firebaseDependencies, tokenDetails);\r\n    return tokenDetails.token;\r\n}\r\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\r\nasync function getPushSubscription(swRegistration, vapidKey) {\r\n    const subscription = await swRegistration.pushManager.getSubscription();\r\n    if (subscription) {\r\n        return subscription;\r\n    }\r\n    return swRegistration.pushManager.subscribe({\r\n        userVisibleOnly: true,\r\n        // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\r\n        // submitted to pushManager#subscribe must be of type Uint8Array.\r\n        applicationServerKey: base64ToArray(vapidKey)\r\n    });\r\n}\r\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\r\nfunction isTokenValid(dbOptions, currentOptions) {\r\n    const isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\r\n    const isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\r\n    const isAuthEqual = currentOptions.auth === dbOptions.auth;\r\n    const isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\r\n    return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction externalizePayload(internalPayload) {\r\n    const payload = {\r\n        from: internalPayload.from,\r\n        // eslint-disable-next-line camelcase\r\n        collapseKey: internalPayload.collapse_key,\r\n        // eslint-disable-next-line camelcase\r\n        messageId: internalPayload.fcmMessageId\r\n    };\r\n    propagateNotificationPayload(payload, internalPayload);\r\n    propagateDataPayload(payload, internalPayload);\r\n    propagateFcmOptions(payload, internalPayload);\r\n    return payload;\r\n}\r\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.notification) {\r\n        return;\r\n    }\r\n    payload.notification = {};\r\n    const title = messagePayloadInternal.notification.title;\r\n    if (!!title) {\r\n        payload.notification.title = title;\r\n    }\r\n    const body = messagePayloadInternal.notification.body;\r\n    if (!!body) {\r\n        payload.notification.body = body;\r\n    }\r\n    const image = messagePayloadInternal.notification.image;\r\n    if (!!image) {\r\n        payload.notification.image = image;\r\n    }\r\n    const icon = messagePayloadInternal.notification.icon;\r\n    if (!!icon) {\r\n        payload.notification.icon = icon;\r\n    }\r\n}\r\nfunction propagateDataPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.data) {\r\n        return;\r\n    }\r\n    payload.data = messagePayloadInternal.data;\r\n}\r\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\r\n    var _a, _b, _c, _d, _e;\r\n    // fcmOptions.link value is written into notification.click_action. see more in b/232072111\r\n    if (!messagePayloadInternal.fcmOptions &&\r\n        !((_a = messagePayloadInternal.notification) === null || _a === void 0 ? void 0 : _a.click_action)) {\r\n        return;\r\n    }\r\n    payload.fcmOptions = {};\r\n    const link = (_c = (_b = messagePayloadInternal.fcmOptions) === null || _b === void 0 ? void 0 : _b.link) !== null && _c !== void 0 ? _c : (_d = messagePayloadInternal.notification) === null || _d === void 0 ? void 0 : _d.click_action;\r\n    if (!!link) {\r\n        payload.fcmOptions.link = link;\r\n    }\r\n    // eslint-disable-next-line camelcase\r\n    const analyticsLabel = (_e = messagePayloadInternal.fcmOptions) === null || _e === void 0 ? void 0 : _e.analytics_label;\r\n    if (!!analyticsLabel) {\r\n        payload.fcmOptions.analyticsLabel = analyticsLabel;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isConsoleMessage(data) {\r\n    // This message has a campaign ID, meaning it was sent using the Firebase Console.\r\n    return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n_mergeStrings('AzSCbw63g1R0nCw85jG8', 'Iaya3yLKwmgvh7cF0q4');\r\nfunction _mergeStrings(s1, s2) {\r\n    const resultArray = [];\r\n    for (let i = 0; i < s1.length; i++) {\r\n        resultArray.push(s1.charAt(i));\r\n        if (i < s2.length) {\r\n            resultArray.push(s2.charAt(i));\r\n        }\r\n    }\r\n    return resultArray.join('');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration Object');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    const configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId',\r\n        'messagingSenderId'\r\n    ];\r\n    const { options } = app;\r\n    for (const keyName of configKeys) {\r\n        if (!options[keyName]) {\r\n            throw getMissingValueError(keyName);\r\n        }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: options.projectId,\r\n        apiKey: options.apiKey,\r\n        appId: options.appId,\r\n        senderId: options.messagingSenderId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */, {\r\n        valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass MessagingService {\r\n    constructor(app, installations, analyticsProvider) {\r\n        // logging is only done with end user consent. Default to false.\r\n        this.deliveryMetricsExportedToBigQueryEnabled = false;\r\n        this.onBackgroundMessageHandler = null;\r\n        this.onMessageHandler = null;\r\n        this.logEvents = [];\r\n        this.isLogServiceStarted = false;\r\n        const appConfig = extractAppConfig(app);\r\n        this.firebaseDependencies = {\r\n            app,\r\n            appConfig,\r\n            installations,\r\n            analyticsProvider\r\n        };\r\n    }\r\n    _delete() {\r\n        return Promise.resolve();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function registerDefaultSw(messaging) {\r\n    try {\r\n        messaging.swRegistration = await navigator.serviceWorker.register(DEFAULT_SW_PATH, {\r\n            scope: DEFAULT_SW_SCOPE\r\n        });\r\n        // The timing when browser updates sw when sw has an update is unreliable from experiment. It\r\n        // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\r\n        // is stuck with the old version. For example,\r\n        // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\r\n        // sw if there was an update.\r\n        messaging.swRegistration.update().catch(() => {\r\n            /* it is non blocking and we don't care if it failed */\r\n        });\r\n    }\r\n    catch (e) {\r\n        throw ERROR_FACTORY.create(\"failed-service-worker-registration\" /* ErrorCode.FAILED_DEFAULT_REGISTRATION */, {\r\n            browserErrorMessage: e === null || e === void 0 ? void 0 : e.message\r\n        });\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function updateSwReg(messaging, swRegistration) {\r\n    if (!swRegistration && !messaging.swRegistration) {\r\n        await registerDefaultSw(messaging);\r\n    }\r\n    if (!swRegistration && !!messaging.swRegistration) {\r\n        return;\r\n    }\r\n    if (!(swRegistration instanceof ServiceWorkerRegistration)) {\r\n        throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* ErrorCode.INVALID_SW_REGISTRATION */);\r\n    }\r\n    messaging.swRegistration = swRegistration;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function updateVapidKey(messaging, vapidKey) {\r\n    if (!!vapidKey) {\r\n        messaging.vapidKey = vapidKey;\r\n    }\r\n    else if (!messaging.vapidKey) {\r\n        messaging.vapidKey = DEFAULT_VAPID_KEY;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function getToken$1(messaging, options) {\r\n    if (!navigator) {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */);\r\n    }\r\n    if (Notification.permission === 'default') {\r\n        await Notification.requestPermission();\r\n    }\r\n    if (Notification.permission !== 'granted') {\r\n        throw ERROR_FACTORY.create(\"permission-blocked\" /* ErrorCode.PERMISSION_BLOCKED */);\r\n    }\r\n    await updateVapidKey(messaging, options === null || options === void 0 ? void 0 : options.vapidKey);\r\n    await updateSwReg(messaging, options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration);\r\n    return getTokenInternal(messaging);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function logToScion(messaging, messageType, data) {\r\n    const eventType = getEventType(messageType);\r\n    const analytics = await messaging.firebaseDependencies.analyticsProvider.get();\r\n    analytics.logEvent(eventType, {\r\n        /* eslint-disable camelcase */\r\n        message_id: data[CONSOLE_CAMPAIGN_ID],\r\n        message_name: data[CONSOLE_CAMPAIGN_NAME],\r\n        message_time: data[CONSOLE_CAMPAIGN_TIME],\r\n        message_device_time: Math.floor(Date.now() / 1000)\r\n        /* eslint-enable camelcase */\r\n    });\r\n}\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function messageEventListener(messaging, event) {\r\n    const internalPayload = event.data;\r\n    if (!internalPayload.isFirebaseMessaging) {\r\n        return;\r\n    }\r\n    if (messaging.onMessageHandler &&\r\n        internalPayload.messageType === MessageType.PUSH_RECEIVED) {\r\n        if (typeof messaging.onMessageHandler === 'function') {\r\n            messaging.onMessageHandler(externalizePayload(internalPayload));\r\n        }\r\n        else {\r\n            messaging.onMessageHandler.next(externalizePayload(internalPayload));\r\n        }\r\n    }\r\n    // Log to Scion if applicable\r\n    const dataPayload = internalPayload.data;\r\n    if (isConsoleMessage(dataPayload) &&\r\n        dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1') {\r\n        await logToScion(messaging, internalPayload.messageType, dataPayload);\r\n    }\r\n}\n\nconst name = \"@firebase/messaging\";\nconst version = \"0.12.12\";\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst WindowMessagingFactory = (container) => {\r\n    const messaging = new MessagingService(container.getProvider('app').getImmediate(), container.getProvider('installations-internal').getImmediate(), container.getProvider('analytics-internal'));\r\n    navigator.serviceWorker.addEventListener('message', e => messageEventListener(messaging, e));\r\n    return messaging;\r\n};\r\nconst WindowMessagingInternalFactory = (container) => {\r\n    const messaging = container\r\n        .getProvider('messaging')\r\n        .getImmediate();\r\n    const messagingInternal = {\r\n        getToken: (options) => getToken$1(messaging, options)\r\n    };\r\n    return messagingInternal;\r\n};\r\nfunction registerMessagingInWindow() {\r\n    _registerComponent(new Component('messaging', WindowMessagingFactory, \"PUBLIC\" /* ComponentType.PUBLIC */));\r\n    _registerComponent(new Component('messaging-internal', WindowMessagingInternalFactory, \"PRIVATE\" /* ComponentType.PRIVATE */));\r\n    registerVersion(name, version);\r\n    // BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\n    registerVersion(name, version, 'esm2017');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Checks if all required APIs exist in the browser.\r\n * @returns a Promise that resolves to a boolean.\r\n *\r\n * @public\r\n */\r\nasync function isWindowSupported() {\r\n    try {\r\n        // This throws if open() is unsupported, so adding it to the conditional\r\n        // statement below can cause an uncaught error.\r\n        await validateIndexedDBOpenable();\r\n    }\r\n    catch (e) {\r\n        return false;\r\n    }\r\n    // firebase-js-sdk/issues/2393 reveals that idb#open in Safari iframe and Firefox private browsing\r\n    // might be prohibited to run. In these contexts, an error would be thrown during the messaging\r\n    // instantiating phase, informing the developers to import/call isSupported for special handling.\r\n    return (typeof window !== 'undefined' &&\r\n        isIndexedDBAvailable() &&\r\n        areCookiesEnabled() &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function deleteToken$1(messaging) {\r\n    if (!navigator) {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */);\r\n    }\r\n    if (!messaging.swRegistration) {\r\n        await registerDefaultSw(messaging);\r\n    }\r\n    return deleteTokenInternal(messaging);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction onMessage$1(messaging, nextOrObserver) {\r\n    if (!navigator) {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */);\r\n    }\r\n    messaging.onMessageHandler = nextOrObserver;\r\n    return () => {\r\n        messaging.onMessageHandler = null;\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Retrieves a Firebase Cloud Messaging instance.\r\n *\r\n * @returns The Firebase Cloud Messaging instance associated with the provided firebase app.\r\n *\r\n * @public\r\n */\r\nfunction getMessagingInWindow(app = getApp()) {\r\n    // Conscious decision to make this async check non-blocking during the messaging instance\r\n    // initialization phase for performance consideration. An error would be thrown latter for\r\n    // developer's information. Developers can then choose to import and call `isSupported` for\r\n    // special handling.\r\n    isWindowSupported().then(isSupported => {\r\n        // If `isWindowSupported()` resolved, but returned false.\r\n        if (!isSupported) {\r\n            throw ERROR_FACTORY.create(\"unsupported-browser\" /* ErrorCode.UNSUPPORTED_BROWSER */);\r\n        }\r\n    }, _ => {\r\n        // If `isWindowSupported()` rejected.\r\n        throw ERROR_FACTORY.create(\"indexed-db-unsupported\" /* ErrorCode.INDEXED_DB_UNSUPPORTED */);\r\n    });\r\n    return _getProvider(getModularInstance(app), 'messaging').getImmediate();\r\n}\r\n/**\r\n * Subscribes the {@link Messaging} instance to push notifications. Returns a Firebase Cloud\r\n * Messaging registration token that can be used to send push messages to that {@link Messaging}\r\n * instance.\r\n *\r\n * If notification permission isn't already granted, this method asks the user for permission. The\r\n * returned promise rejects if the user does not allow the app to show notifications.\r\n *\r\n * @param messaging - The {@link Messaging} instance.\r\n * @param options - Provides an optional vapid key and an optional service worker registration.\r\n *\r\n * @returns The promise resolves with an FCM registration token.\r\n *\r\n * @public\r\n */\r\nasync function getToken(messaging, options) {\r\n    messaging = getModularInstance(messaging);\r\n    return getToken$1(messaging, options);\r\n}\r\n/**\r\n * Deletes the registration token associated with this {@link Messaging} instance and unsubscribes\r\n * the {@link Messaging} instance from the push subscription.\r\n *\r\n * @param messaging - The {@link Messaging} instance.\r\n *\r\n * @returns The promise resolves when the token has been successfully deleted.\r\n *\r\n * @public\r\n */\r\nfunction deleteToken(messaging) {\r\n    messaging = getModularInstance(messaging);\r\n    return deleteToken$1(messaging);\r\n}\r\n/**\r\n * When a push message is received and the user is currently on a page for your origin, the\r\n * message is passed to the page and an `onMessage()` event is dispatched with the payload of\r\n * the push message.\r\n *\r\n *\r\n * @param messaging - The {@link Messaging} instance.\r\n * @param nextOrObserver - This function, or observer object with `next` defined,\r\n *     is called when a message is received and the user is currently viewing your page.\r\n * @returns To stop listening for messages execute this returned function.\r\n *\r\n * @public\r\n */\r\nfunction onMessage(messaging, nextOrObserver) {\r\n    messaging = getModularInstance(messaging);\r\n    return onMessage$1(messaging, nextOrObserver);\r\n}\n\n/**\r\n * The Firebase Cloud Messaging Web SDK.\r\n * This SDK does not work in a Node.js environment.\r\n *\r\n * @packageDocumentation\r\n */\r\nregisterMessagingInWindow();\n\nexport { deleteToken, getMessagingInWindow as getMessaging, getToken, isWindowSupported as isSupported, onMessage };\n//# sourceMappingURL=index.esm2017.js.map\n","import { WebPlugin } from '@capacitor/core';\nimport { deleteToken, getMessaging, getToken, isSupported as isSupportedInWeb, onMessage, } from 'firebase/messaging';\nexport class FirebaseMessagingWeb extends WebPlugin {\n    constructor() {\n        super();\n        isSupportedInWeb().then(supported => {\n            if (!supported) {\n                return;\n            }\n            const messaging = getMessaging();\n            onMessage(messaging, payload => this.handleNotificationReceived(payload));\n        });\n    }\n    async checkPermissions() {\n        const receive = this.convertNotificationPermissionToPermissionState(Notification.permission);\n        return {\n            receive,\n        };\n    }\n    async requestPermissions() {\n        const notificationPermission = await Notification.requestPermission();\n        const receive = this.convertNotificationPermissionToPermissionState(notificationPermission);\n        return {\n            receive,\n        };\n    }\n    async isSupported() {\n        const isSupported = await isSupportedInWeb();\n        return {\n            isSupported,\n        };\n    }\n    async getToken(options) {\n        const messaging = getMessaging();\n        const token = await getToken(messaging, {\n            vapidKey: options.vapidKey,\n            serviceWorkerRegistration: options.serviceWorkerRegistration,\n        });\n        return {\n            token,\n        };\n    }\n    async deleteToken() {\n        const messaging = getMessaging();\n        await deleteToken(messaging);\n    }\n    async getDeliveredNotifications() {\n        this.throwUnavailableError();\n    }\n    async removeDeliveredNotifications(_options) {\n        this.throwUnavailableError();\n    }\n    async removeAllDeliveredNotifications() {\n        this.throwUnavailableError();\n    }\n    async subscribeToTopic(_options) {\n        this.throwUnavailableError();\n    }\n    async unsubscribeFromTopic(_options) {\n        this.throwUnavailableError();\n    }\n    async createChannel(_options) {\n        this.throwUnavailableError();\n    }\n    async deleteChannel(_options) {\n        this.throwUnavailableError();\n    }\n    async listChannels() {\n        this.throwUnavailableError();\n    }\n    handleNotificationReceived(messagePayload) {\n        const notification = this.createNotificationResult(messagePayload);\n        const event = {\n            notification,\n        };\n        this.notifyListeners(FirebaseMessagingWeb.notificationReceivedEvent, event);\n    }\n    createNotificationResult(messagePayload) {\n        var _a, _b, _c;\n        const notification = {\n            body: (_a = messagePayload.notification) === null || _a === void 0 ? void 0 : _a.body,\n            data: messagePayload.data,\n            id: messagePayload.messageId,\n            image: (_b = messagePayload.notification) === null || _b === void 0 ? void 0 : _b.image,\n            title: (_c = messagePayload.notification) === null || _c === void 0 ? void 0 : _c.title,\n        };\n        return notification;\n    }\n    convertNotificationPermissionToPermissionState(permission) {\n        let state = 'prompt';\n        switch (permission) {\n            case 'granted':\n                state = 'granted';\n                break;\n            case 'denied':\n                state = 'denied';\n                break;\n        }\n        return state;\n    }\n    throwUnavailableError() {\n        throw this.unavailable('Not available on web.');\n    }\n}\nFirebaseMessagingWeb.notificationReceivedEvent = 'notificationReceived';\n//# sourceMappingURL=web.js.map"],"names":["name","version","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","ErrorFactory","isServerError","error","FirebaseError","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","response","getExpiresInFromResponseExpiresIn","getErrorFromResponse","requestName","errorData","getHeaders","apiKey","getHeadersWithAuth","appConfig","refreshToken","headers","getAuthorizationHeader","retryIfServerError","fn","result","responseExpiresIn","createInstallationRequest","heartbeatServiceProvider","fid","endpoint","heartbeatService","heartbeatsHeader","body","request","responseValue","sleep","ms","resolve","bufferToBase64UrlSafe","array","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","encode","getKey","fidChangeCallbacks","fidChanged","key","callFidChangeCallbacks","broadcastFidChange","callbacks","callback","channel","getBroadcastChannel","closeBroadcastChannel","broadcastChannel","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","openDB","db","oldVersion","set","value","tx","objectStore","oldValue","remove","update","updateFn","store","newValue","getInstallationEntry","installations","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","clearTimedOutRequest","registrationPromiseWithError","inProgressEntry","registerInstallation","waitUntilFidRegistration","registeredInstallationEntry","e","updateInstallationRequest","hasInstallationRequestTimedOut","generateAuthTokenRequest","getGenerateAuthTokenEndpoint","refreshAuthToken","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","authToken","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","now","inProgressAuthToken","getId","installationsImpl","getToken","completeInstallationRegistration","extractAppConfig","app","getMissingValueError","configKeys","keyName","valueName","INSTALLATIONS_NAME","INSTALLATIONS_NAME_INTERNAL","publicFactory","container","_getProvider","internalFactory","registerInstallations","_registerComponent","Component","registerVersion","DEFAULT_SW_PATH","DEFAULT_SW_SCOPE","DEFAULT_VAPID_KEY","ENDPOINT","CONSOLE_CAMPAIGN_ID","CONSOLE_CAMPAIGN_NAME","CONSOLE_CAMPAIGN_TIME","CONSOLE_CAMPAIGN_ANALYTICS_ENABLED","MessageType$1","MessageType","arrayToBase64","uint8Array","base64ToArray","base64String","padding","base64","rawData","outputArray","i","OLD_DB_NAME","OLD_DB_VERSION","OLD_OBJECT_STORE_NAME","migrateOldDatabase","senderId","tokenDetails","newVersion","upgradeTransaction","_a","oldDetails","deleteDB","checkTokenDetails","subscriptionOptions","upgradeDb","dbGet","firebaseDependencies","oldTokenDetails","dbSet","dbRemove","ERROR_MAP","requestGetToken","getBody","subscribeOptions","responseData","getEndpoint","err","message","requestUpdateToken","updateOptions","requestDeleteToken","token","unsubscribeOptions","p256dh","auth","vapidKey","TOKEN_EXPIRATION_MS","getTokenInternal","messaging","pushSubscription","getPushSubscription","isTokenValid","updateToken","getNewToken","deleteTokenInternal","updatedToken","updatedTokenDetails","swRegistration","subscription","dbOptions","currentOptions","isVapidKeyEqual","isEndpointEqual","isAuthEqual","isP256dhEqual","externalizePayload","internalPayload","payload","propagateNotificationPayload","propagateDataPayload","propagateFcmOptions","messagePayloadInternal","title","image","icon","_b","_c","_d","_e","link","analyticsLabel","isConsoleMessage","data","options","MessagingService","analyticsProvider","registerDefaultSw","updateSwReg","updateVapidKey","getToken$1","logToScion","messageType","eventType","getEventType","messageEventListener","event","dataPayload","WindowMessagingFactory","WindowMessagingInternalFactory","registerMessagingInWindow","isWindowSupported","validateIndexedDBOpenable","isIndexedDBAvailable","areCookiesEnabled","deleteToken$1","onMessage$1","nextOrObserver","getMessagingInWindow","getApp","isSupported","_","getModularInstance","deleteToken","onMessage","FirebaseMessagingWeb","WebPlugin","isSupportedInWeb","supported","getMessaging","notificationPermission","_options","messagePayload","permission","state"],"mappings":"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","x_google_ignoreList":[0,1,2]}