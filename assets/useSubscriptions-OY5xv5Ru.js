import{t as l}from"./toast-DdvjuUw5.js";import{r as s,G as k,f as w}from"./index-DHovczjU.js";const L=()=>{var g,h,S,y,E;const{fetchProducts:b,fetchMyProducts:p,products:r,userProducts:e,user:f,attachProduct:m,cancelSubscription:u}=s.useContext(k.EscolaLMSContext),{t:a}=w(),o=s.useCallback(async()=>{try{await b({type:"subscription-all-in",pageSize:500})}catch(t){console.error("Error fetching subscriptions:",t),l(String(a("UnexpectedError")),"error")}},[b,a]),c=s.useCallback(async()=>{try{await p({type:"subscription-all-in",pageSize:500})}catch(t){console.error("Error fetching subscriptions:",t),l(String(a("UnexpectedError")),"error")}},[p,a]),M=s.useCallback(async t=>{try{await u(t)}catch(i){console.error("Error fetching subscriptions:",i),l(String(a("UnexpectedError")),"error")}},[a,u]),d=s.useMemo(()=>{var t,i,n;return(n=(t=r==null?void 0:r.list)==null?void 0:t.data)==null?void 0:n.reduce((x,C)=>x.price>C.price?C:x,(i=r==null?void 0:r.list)==null?void 0:i.data[0])},[(g=r==null?void 0:r.list)==null?void 0:g.data]),v=s.useMemo(()=>{var t,i;return(i=(t=e==null?void 0:e.list)==null?void 0:t.data)==null?void 0:i.find(n=>n==null?void 0:n.is_active)},[(h=e==null?void 0:e.list)==null?void 0:h.data]);return s.useEffect(()=>{var t;(t=f.value)!=null&&t.id&&c(),o()},[o,c,(S=f.value)==null?void 0:S.id]),{fetchSubscriptions:o,fetchMySubscriptions:c,userProducts:((y=e==null?void 0:e.list)==null?void 0:y.data)??[],subscriptions:((E=r==null?void 0:r.list)==null?void 0:E.data)??[],isLoading:r.loading,getCheapestSubscription:d,getActiveSubscription:v,attachProduct:m,subscriptionCancel:M}};export{L as u};
