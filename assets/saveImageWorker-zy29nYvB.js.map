{"version":3,"file":"saveImageWorker-zy29nYvB.js","sources":["../src/workers/saveImageWorker.ts"],"sourcesContent":["export {};\n\nexport interface SaveImagesMessage {\n  consultationId: number;\n  consultationTermId: number;\n  userEmail: string;\n  userId: number;\n  screenshots: { dataURL: Blob; timestamp: number }[];\n  term: string;\n}\n\nself.onmessage = async (event: MessageEvent<SaveImagesMessage>) => {\n  const {\n    consultationId,\n    consultationTermId,\n    userEmail,\n    userId,\n    screenshots,\n    term,\n  } = event.data;\n\n  try {\n    const filenames = screenshots.map((screenshot) => ({\n      filename: `${screenshot.timestamp}.webp`,\n    }));\n\n    const signUrls = await fetch(\n      `${\n        import.meta.env.VITE_APP_PUBLIC_API_URL\n      }/api/consultations/signed-screen-urls`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          consultation_id: consultationId,\n          user_termin_id: consultationTermId,\n          user_id: userId,\n          user_email: userEmail,\n          files: filenames,\n          executed_at: term,\n        }),\n      }\n    );\n\n    if (!signUrls.ok) {\n      throw new Error(`Failed to sign URLs: ${signUrls.statusText}`);\n    }\n\n    const responseData = await signUrls.json();\n\n    for (let i = 0; i < responseData.data.length; i++) {\n      const { url, filename } = responseData.data[i];\n      const screenshot = screenshots.find(\n        (s) => `${s.timestamp}.webp` === filename\n      );\n\n      if (!screenshot) {\n        console.warn(`Screenshot not found for filename: ${filename}`);\n        continue;\n      }\n\n      try {\n        const blob = new Blob([screenshot.dataURL]);\n        const response = await fetch(url, {\n          method: \"PUT\",\n          body: blob,\n        });\n\n        if (!response.ok) {\n          console.error(`Failed to upload ${filename}: ${response.statusText}`);\n        } else {\n          console.log(`File ${filename} uploaded successfully.`);\n        }\n      } catch (error) {\n        console.error(`Error uploading ${filename}:`, error);\n      }\n    }\n\n    self.postMessage({ success: true });\n  } catch (error) {\n    self.postMessage({\n      success: false,\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n};\n"],"names":["event","consultationId","consultationTermId","userEmail","userId","screenshots","term","filenames","screenshot","signUrls","responseData","i","url","filename","s","blob","response","error"],"mappings":"yBAWA,KAAK,UAAY,MAAOA,GAA2C,CAC3D,KAAA,CACJ,eAAAC,EACA,mBAAAC,EACA,UAAAC,EACA,OAAAC,EACA,YAAAC,EACA,KAAAC,GACEN,EAAM,KAEN,GAAA,CACF,MAAMO,EAAYF,EAAY,IAAKG,IAAgB,CACjD,SAAU,GAAGA,EAAW,SAAS,OAAA,EACjC,EAEIC,EAAW,MAAM,MACrB,0EAGA,CACE,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CACnB,gBAAiBR,EACjB,eAAgBC,EAChB,QAASE,EACT,WAAYD,EACZ,MAAOI,EACP,YAAaD,CACd,CAAA,CAAA,CAEL,EAEI,GAAA,CAACG,EAAS,GACZ,MAAM,IAAI,MAAM,wBAAwBA,EAAS,UAAU,EAAE,EAGzD,MAAAC,EAAe,MAAMD,EAAS,KAAK,EAEzC,QAASE,EAAI,EAAGA,EAAID,EAAa,KAAK,OAAQC,IAAK,CACjD,KAAM,CAAE,IAAAC,EAAK,SAAAC,CAAA,EAAaH,EAAa,KAAKC,CAAC,EACvCH,EAAaH,EAAY,KAC5BS,GAAM,GAAGA,EAAE,SAAS,UAAYD,CACnC,EAEA,GAAI,CAACL,EAAY,CACP,QAAA,KAAK,sCAAsCK,CAAQ,EAAE,EAC7D,QAAA,CAGE,GAAA,CACF,MAAME,EAAO,IAAI,KAAK,CAACP,EAAW,OAAO,CAAC,EACpCQ,EAAW,MAAM,MAAMJ,EAAK,CAChC,OAAQ,MACR,KAAMG,CAAA,CACP,EAEIC,EAAS,GAGJ,QAAA,IAAI,QAAQH,CAAQ,yBAAyB,EAFrD,QAAQ,MAAM,oBAAoBA,CAAQ,KAAKG,EAAS,UAAU,EAAE,QAI/DC,EAAO,CACd,QAAQ,MAAM,mBAAmBJ,CAAQ,IAAKI,CAAK,CAAA,CACrD,CAGF,KAAK,YAAY,CAAE,QAAS,EAAA,CAAM,QAC3BA,EAAO,CACd,KAAK,YAAY,CACf,QAAS,GACT,MAAOA,aAAiB,MAAQA,EAAM,QAAU,eAAA,CACjD,CAAA,CAEL"}