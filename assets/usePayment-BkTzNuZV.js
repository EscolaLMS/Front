import{r as i,h as M,f as k,i as R,l as W,aR as s,cD as d}from"./index-DvAWm433.js";const D=()=>{var v,E,x;const{user:e,cart:f,fetchCart:$,removeFromCart:h,payWithStripe:p,payWithP24:y,subscriptionPayWithP24:m,courses:P,realizeVoucher:g}=i.useContext(M.EscolaLMSContext),{t}=k(),{push:l,location:S}=R(),[b,r]=i.useState(!1),[w,C]=i.useState(f.value.additional_discount>0?"granted":void 0);i.useEffect(()=>{!e.loading&&!e.value&&l(W.login)},[]);const U=i.useCallback(async u=>{var a;r(!0);try{if(!((a=e.value)!=null&&a.email)){s.error(`${t("MissingEmailError")}`),r(!1);return}await p(u,`${d}/#/cart?status=success`),r(!1),l("/cart?status=success")}catch(o){s.error(`${t("UnexpectedError")}`),r(!1),console.error(o)}},[p,l,t,(v=e.value)==null?void 0:v.email]),_=i.useCallback(async u=>{var a,o;r(!0);try{if(!((a=e.value)!=null&&a.email)){s.error(`${t("MissingEmailError")}`),r(!1);return}const c=await y((o=e.value)==null?void 0:o.email,`${d}/#/cart?status=success`,u||void 0);if(c.data.redirect_url===void 0){s.error(`${t("UnexpectedError")}`),r(!1);return}r(!1),window.open(c.data.redirect_url)}catch(c){s.error(`${t("UnexpectedError")}`),r(!1),console.error(c)}},[y,t,(E=e.value)==null?void 0:E.email]),B=i.useCallback(async u=>{var a,o,c;if(r(!0),!((a=e.value)!=null&&a.email)){s.error(`${t("MissingEmailError")}`),r(!1);return}try{const n=await m(u,(o=e.value)==null?void 0:o.email,`${d}/#/cart?status=success`);if(console.log("buySubscriptionByP24",(c=e.value)==null?void 0:c.email),n.data.redirect_url===void 0){s.error(`${t("UnexpectedError")}`),r(!1);return}r(!1),window.open(n.data.redirect_url)}catch{s.error(`${t("UnexpectedError")}`)}},[t,m,(x=e.value)==null?void 0:x.email]);return{user:e,processing:b,setProcessing:r,discountStatus:w,payByStripe:U,payByP24:_,removeFromCart:h,courses:P,cart:f,location:S,push:l,realizeVoucher:g,setDiscountStatus:C,fetchCart:$,buySubscriptionByP24:B}};export{D as u};
