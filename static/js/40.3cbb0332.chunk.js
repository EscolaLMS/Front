(this["webpackJsonpescolalms-demo"]=this["webpackJsonpescolalms-demo"]||[]).push([[40],{618:function(e,t,o){"use strict";o.r(t);var n=o(1),s=o.n(n),i=o(36),r=o(35),c=o(683),l=o(270),a=o(46),d=o(72),u=o(268),b=o(82),m=o(92),j=o(34),p=o(382),v=o(772),h=o(730);var x=o(273),g=o(704);var O,f=o(678),C=o(187),T=o(70),k=o(29),N=o(17),y=o(27),w=o(3);const P=N.default.div(O||(O=Object(T.a)(["\n  min-height: calc(100vh - 150px);\n  text-align: center;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n\n  .buttons-block {\n    display: grid;\n    gap: 8px;\n  }\n"])));var I,S=e=>{let{error:t,goTo:o=y.a.courses,goToText:n,alternativeButton:s}=e;const{t:r}=Object(u.a)(),c=Object(i.g)(),a=null!==n&&void 0!==n?n:r("CoursePage.SeeOtherCourses");return Object(w.jsx)(l.a,{children:Object(w.jsxs)(P,{children:[Object(w.jsx)(k.Text,{size:"16",children:Object(w.jsx)("strong",{children:r("CoursePage.ErrorOccurred")})}),Object(w.jsx)(k.Text,{size:"14",children:t}),Object(w.jsx)("hr",{}),Object(w.jsxs)("div",{className:"buttons-block",children:[Object(w.jsx)(k.Button,{mode:"secondary",onClick:()=>c.push(o),children:a}),s&&Object(w.jsx)(k.Button,{mode:"outline",onClick:()=>c.push(s.goTo),children:s.goToText})]})]})})};const _=N.default.section(I||(I=Object(T.a)(['\n  padding-bottom: 110px;\n  .main-title {\n    margin-bottom: 20px;\n  }\n  .course-nav {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    z-index: 100;\n  }\n  img {\n    max-width: 100%;\n    height: auto;\n  }\n\n  .course-program-finish-modal {\n    font-family: "Mulish", sans-serif;\n    background: #f8f8f8;\n    inset: 0;\n    border: 1px solid #157493;\n    padding: 16px;\n    display: grid;\n    place-content: center;\n    gap: 16px;\n    height: 100%;\n    max-height: 500px;\n\n    p {\n      text-align: center;\n      margin: 0;\n    }\n\n    &__title {\n      font-size: 24px;\n      font-weight: 500;\n    }\n\n    &__paragraph {\n      font-size: 18px;\n    }\n\n    &__buttons {\n      display: grid;\n      grid-auto-flow: column;\n      gap: 8px;\n      justify-content: center;\n      margin-top: 8px;\n    }\n  }\n'])));var B=o(74),E=o(52),R=o(738),M=o(684),q=o(706);var A,F=e=>{let{courseId:t}=e;const{t:o}=Object(u.a)(),{push:s}=Object(i.g)(),[r,c]=Object(n.useState)({show:!1,step:0,loading:!1}),[l,a]=Object(n.useState)([]),{fetchQuestionnaires:d,fetchQuestionnaire:b}=Object(n.useContext)(E.EscolaLMSContext),m=Object(n.useCallback)((()=>{if(c((e=>({...e,show:!1}))),r.step<l.length-1){c((e=>({...e,step:e.step+1})));const e=setTimeout((()=>{c((e=>({...e,show:!0})))}),500);return()=>clearTimeout(e)}}),[l,r.step]);return Object(n.useEffect)((()=>{c((e=>({...e,loading:!0}))),t&&Object(q.c)({courseId:t,fetchQuestionnaire:b,fetchQuestionnaires:d,onSucces:e=>{a(e)},onFinish:()=>c((e=>({...e,loading:!1})))})}),[t]),Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("div",{className:"course-program-finish-modal",children:r.loading?Object(w.jsx)(k.Spin,{}):Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("p",{className:"course-program-finish-modal__title",children:o("CourseProgram.FinishTitle")}),Object(w.jsx)("p",{className:"course-program-finish-modal__paragraph",children:null!==l&&void 0!==l&&l.length?o("CourseProgram.FinishSubtitle"):o("CourseProgram.FinishSubtitleNoRating")}),Object(w.jsxs)("div",{className:"course-program-finish-modal__buttons",children:[!(null===l||void 0===l||!l.length)&&Object(w.jsx)(B.Button,{mode:"primary",onClick:()=>c((e=>({...e,show:!0}))),children:o("MyProfilePage.RateCourse")}),Object(w.jsx)(B.Button,{mode:"primary",onClick:()=>s(y.a.myProfile),children:o("Menu.Profile")}),Object(w.jsx)(B.Button,{mode:"primary",onClick:()=>s(y.a.courses),children:o("Menu.Courses")})]})]})}),r.show&&t&&!!l.length&&Object(w.jsx)(R.a,{course:M.b.COURSE,courseId:t,visible:r.show,onClose:()=>m(),questionnaire:l[r.step]})]})},L=o(241),Q=o(774),z=o(383);const D=N.default.div(A||(A=Object(T.a)(["\n  margin-top: 100px;\n"])));var U=e=>{let{resources:t,subtitle:o}=e;const{t:n}=Object(u.a)(),s=t.map((e=>({href:e.url,fileName:e.name})));return Object(w.jsx)(D,{children:Object(w.jsx)(z.Downloads,{subtitle:o,title:n("CourseProgram.TopicAttachment"),downloads:s})})};var X=e=>{var t,o;let{lesson:n,topic:s,disableNextTopicButton:i,getNextPrevTopic:r,onXAPI:c}=e;const l=n&&n.summary&&s&&s.summary?6:12;return Object(w.jsxs)("div",{className:"course-program-player",children:[Object(w.jsxs)("div",{className:"course-program-player-content",children:[s&&s.introduction&&Object(w.jsx)(L.MarkdownRenderer,{children:s.introduction}),Object(w.jsx)("div",{className:"course-program-player-content__wrapper",style:{...(null===s||void 0===s||null===(t=s.json)||void 0===t?void 0:t.wrapperStyle)||{}},children:Object(w.jsx)(Q.a,{topic:s,disableNextTopicButton:i,isThereAnotherTopic:Boolean(r(Number(null===s||void 0===s?void 0:s.id))),onXAPI:e=>null===c||void 0===c?void 0:c(e)},null===s||void 0===s?void 0:s.id)})]}),Object(w.jsx)("div",{className:"course-program-content__container",children:Object(w.jsxs)(b.Row,{children:[n&&n.summary&&Object(w.jsx)(b.Col,{sm:12,md:l,lg:l,children:Object(w.jsx)("div",{className:"course-program-summary",children:Object(w.jsx)(L.MarkdownRenderer,{children:n.summary})})}),s&&s.summary&&Object(w.jsx)(b.Col,{sm:12,md:l,lg:l,children:Object(w.jsxs)("div",{className:"course-program-summary",children:[Object(w.jsx)(L.MarkdownRenderer,{children:s.summary}),s&&s.resources&&(null===(o=s.resources)||void 0===o?void 0:o.length)>0&&Object(w.jsx)(U,{resources:s.resources||[],subtitle:s.introduction||""})]})})]})})]})};var W=e=>{let{program:t,courseId:o}=e;const{topic:s,lesson:c,onNextTopic:l,onPrevTopic:O,getNextPrevTopic:T,isNextTopicButtonDisabled:k,disableNextTopicButton:N,sendProgress:P}=Object(h.a)(t),[I,B]=Object(n.useState)(!1),{onCompleteTopic:E,onXAPI:R}=(e=>{let{program:t,disableNextTopicButton:o,isThereAnotherTopic:s=!0}=e;const{topicID:c}=Object(i.i)(),{sendProgress:l,h5pProgress:a}=Object(n.useContext)(r.EscolaLMSContext),[d,u]=Object(n.useState)(null),b=Object(n.useCallback)((function(e){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var n;null!==t&&void 0!==t&&t.id&&(null===(n=a(String(null===t||void 0===t?void 0:t.id),Number(c),null===e||void 0===e?void 0:e.statement))||void 0===n||n.then((()=>{o&&u(null)})))}),[null===t||void 0===t?void 0:t.id,c,a]);return{onCompleteTopic:Object(n.useCallback)((()=>{console.log("onCompleteTopic: ",d),o&&o(!1),null!==t&&void 0!==t&&t.id&&!d?l(null===t||void 0===t?void 0:t.id,[{topic_id:Number(c),status:1}]):d&&b(d)}),[d,o,null===t||void 0===t?void 0:t.id,l,c,b]),onXAPI:Object(n.useCallback)((e=>{var t,n,i,r;s&&o&&o(!Boolean(null===e||void 0===e||null===(t=e.statement)||void 0===t||null===(n=t.verb)||void 0===n?void 0:n.id)),u(e),null!==e&&void 0!==e&&e.statement&&"http://adlnet.gov/expapi/verbs/completed"!==(null===e||void 0===e||null===(i=e.statement)||void 0===i||null===(r=i.verb)||void 0===r?void 0:r.id)&&b(e,!1)}),[s,o,b]),onCompleteH5pTopic:b}})({program:t}),{topicBookmark:M,handleBookmark:q,topicNote:A}=(e=>{var t,o;let{topic:s,courseId:i,program:c,lesson:l}=e;const{bookmarkNotes:a,fetchBookmarkNotes:d,createBookmarkNote:b,deleteBookmarkNote:m}=Object(n.useContext)(r.EscolaLMSContext),{t:j}=Object(u.a)(),p=Object(n.useMemo)((()=>{var e;return null===(e=a.list)||void 0===e?void 0:e.data.filter((e=>e.bookmarkable_id===Number(null===s||void 0===s?void 0:s.id)&&null===e.value))}),[null===(t=a.list)||void 0===t?void 0:t.data,null===s||void 0===s?void 0:s.id]),v=Object(n.useMemo)((()=>{var e;return null===(e=a.list)||void 0===e?void 0:e.data.filter((e=>e.bookmarkable_id===Number(null===s||void 0===s?void 0:s.id)&&null!==e.value))}),[null===(o=a.list)||void 0===o?void 0:o.data,null===s||void 0===s?void 0:s.id]);return{handleBookmark:()=>null!==p&&void 0!==p&&p.length?m(p[0].id).then((()=>{d(),x.b.success(j("Notifications.DeleteBookmark"))})):b({bookmarkable_id:Number(null===s||void 0===s?void 0:s.id),bookmarkable_type:g.API.BookmarkableType.Topic,value:null}).then((()=>{d(),x.b.success(j("Notifications.CreateBookmark"))})),topicBookmark:p,topicNote:v}})({topic:s,lesson:c,program:t,courseId:o}),{finishedTopicIndex:L}=(e=>{let{courseId:t,program:o,topic:s}=e;const{courseProgressDetails:c,progress:l}=Object(n.useContext)(r.EscolaLMSContext),a=Object(i.h)(),{push:d}=Object(i.g)(),u=3===a.pathname.split("/").length,b=Object(n.useMemo)((()=>{var e,o;return null!==(e=c.byId)&&void 0!==e&&e[Number(t)]&&c.byId[Number(t)].value?c.byId[Number(t)].value:l&&l.value&&(null===(o=l.value.find((e=>e.course.id===Number(t))))||void 0===o?void 0:o.progress)}),[l,t]),m=Object(n.useMemo)((()=>{const e=b||[],t=e.filter((e=>e.status===g.API.CourseProgressItemElementStatus.IN_PROGRESS)).sort(((e,t)=>new Date(t.started_at).getTime()-new Date(e.started_at).getTime()))[0];return t||e.filter((e=>e.status===g.API.CourseProgressItemElementStatus.INCOMPLETE))[0]}),[b]),j=Object(n.useMemo)((()=>m&&o.lessons.find((e=>e&&e.topics&&e.topics.some((e=>e.id===m.topic_id))))),[o,m]);Object(n.useEffect)((()=>{u&&j&&m&&d("/course/".concat(o.id,"/").concat(j.id,"/").concat(m.topic_id),null)}),[u,j,o,d,m]);const p=null===b||void 0===b?void 0:b.findIndex((e=>e.topic_id===(null===s||void 0===s?void 0:s.id)&&e.status===g.API.CourseProgressItemElementStatus.COMPLETE));return{getCourseProgress:b,finishedTopicIndex:p}})({courseId:o,program:t,topic:s}),{t:Q}=Object(u.a)();return Object(n.useEffect)((()=>{window.scrollTo({top:0,behavior:"smooth"})}),[null===c||void 0===c?void 0:c.id,null===s||void 0===s?void 0:s.id]),Object(n.useEffect)((()=>{t&&s&&(null!==T(Number(null===s||void 0===s?void 0:s.id))||N(!0))}),[null===s||void 0===s?void 0:s.id,t]),window.resetProgress=()=>(async()=>{await P(t.id,t.lessons.flatMap((e=>e.topics)).map((e=>({topic_id:Number(null===e||void 0===e?void 0:e.id),status:0}))))})(),t?s?Object(w.jsxs)(_,{className:"course-program-wrapper",children:[Object(w.jsxs)(C.a,{children:[Object(w.jsx)(f.a,{items:[Object(w.jsx)(a.c,{to:y.a.home,children:Q("Home")}),Object(w.jsx)(a.c,{to:y.a.courses,children:Q("Courses")}),Object(w.jsx)(j.Text,{size:"12",children:t.title}),Object(w.jsx)(j.Text,{size:"12",children:s.title})]}),Object(w.jsx)(m.Title,{className:"main-title",level:3,children:s.title}),Object(w.jsxs)(b.Row,{children:[Object(w.jsxs)(b.Col,{lg:9,children:[I&&Object(w.jsx)(F,{courseId:o}),!I&&Object(w.jsx)(X,{lesson:c,topic:s,onXAPI:R,disableNextTopicButton:N,getNextPrevTopic:T})]}),Object(w.jsx)(b.Col,{lg:3,children:Object(w.jsx)(v.a,{course:t,topicId:Number(null===s||void 0===s?void 0:s.id),onCourseFinish:()=>B(!0),onCompleteTopic:E})})]})]}),Object(w.jsx)("div",{className:"course-nav",children:Object(w.jsx)(C.a,{children:Object(w.jsx)(p.CourseTopNav,{onFinish:()=>E(),mobile:d.isMobile,onNext:l,isFinished:!!L&&L>-1,onPrev:O,addNotes:!0,newNoteData:{id:s.id,type:"".concat(o,"/").concat(null===c||void 0===c?void 0:c.id,"/").concat(null===s||void 0===s?void 0:s.id,":").concat(t.title,":").concat(null===s||void 0===s?void 0:s.title)},currentNote:null===A||void 0===A?void 0:A[0],addBookmarks:!0,bookmarkBtnText:null!==M&&void 0!==M&&M.length?"deleteBookmark":"addBookmark",onBookmarkClick:()=>q(),hasPrev:!!T(Number(null===s||void 0===s?void 0:s.id),!1),hasNext:!k})})})]}):Object(w.jsx)(S,{error:Q("CourseProgram.NoTopic"),goTo:"/course/".concat(t.id),goToText:Q("CoursePage.BackToCourse"),alternativeButton:{goTo:y.a.courses,goToText:Q("CoursePage.SeeOtherCourses")}}):Object(w.jsx)(S,{error:Q("CourseProgram.NoProgram")})},Y=o(111),H=o(771);const J=e=>{let{program:t}=e;const o=null===t||void 0===t?void 0:t.scorm_sco,n=null===o||void 0===o?void 0:o.uuid;return o||n?Object(w.jsx)(H.a,{value:{title:o.title,uuid:o.uuid}}):Object(w.jsx)(s.a.Fragment,{})};t.default=()=>{var e;const{id:t}=Object(i.i)(),{program:o,fetchProgram:s,fetchCourseProgress:a}=Object(n.useContext)(r.EscolaLMSContext);return Object(n.useEffect)((()=>{t&&(s(Number(t)),a(Number(t)))}),[t]),o.loading?Object(w.jsx)(c.a,{}):o.error?Object(w.jsx)(S,{error:Object(Y.t)("CourseProgram.NoProgram")}):o.value&&null!==o&&void 0!==o&&null!==(e=o.value)&&void 0!==e&&e.scorm_sco_id?Object(w.jsx)(l.a,{metaTitle:o.value.title,children:Object(w.jsx)(J,{program:o.value})}):o.value&&o.value.lessons&&o.value.lessons.length?Object(w.jsx)(l.a,{metaTitle:o.value.title,children:Object(w.jsx)(W,{program:o.value,courseId:Number(t)})}):Object(w.jsx)(c.a,{})}},678:function(e,t,o){"use strict";var n,s=o(70),i=(o(1),o(361)),r=o(17),c=o(3);const l=r.default.div(n||(n=Object(s.a)(["\n  margin-bottom: 15px;\n  a {\n    text-decoration: none;\n    color: ","!important;\n  }\n"])),(e=>{let{theme:t}=e;return"dark"===t.mode?t.gray5:t.gray2}));t.a=e=>{let{items:t}=e;return Object(c.jsx)(l,{children:Object(c.jsx)(i.BreadCrumbs,{items:t})})}},684:function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"a",(function(){return s}));let n=function(e){return e.COURSE="course",e.WEBINAR="webinar",e}({}),s=function(e){return e.RATE="rate",e.TEXT="text",e.REVIEW="review",e}({})},706:function(e,t,o){"use strict";o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return c})),o.d(t,"b",(function(){return l}));var n=o(684),s=o(111),i=o(273);const r=async e=>{let{courseId:t,fetchQuestionnaires:o,fetchQuestionnaire:r,onSucces:c,onFinish:l}=e;try{const e=t&&await o(n.b.COURSE,t);if(e&&e.success){const o=await Promise.all(e.data.map((async e=>{const o=await(async e=>{let{courseId:t,questionnaireId:o,fetchQuestionnaire:r}=e;try{const e=t&&await r(n.b.COURSE,t,o);if(e&&e.success)return e.data.questions}catch(c){i.b.error(Object(s.t)("UnexpectedError")),console.log(c)}})({courseId:t,questionnaireId:e.id,fetchQuestionnaire:r}),c=e.questions.reduce(((e,t)=>{const n=null===o||void 0===o?void 0:o.find((e=>e.id===t.id)),s={...t,rate:null===n||void 0===n?void 0:n.rate,note:null===n||void 0===n?void 0:n.note};return null===s.rate&&null===s.note&&e.push(s),e}),[]);return{...e,questions:c.sort(((e,t)=>e.position-t.position))}})));c(o.filter((e=>!!e.questions.length)))}}catch(a){i.b.error(Object(s.t)("UnexpectedError")),console.log(a)}finally{l()}},c=e=>(e.reduce(((e,t)=>e+t.avg_rate),0)/e.length).toFixed(1),l=e=>{var t,o;let{questionnaires:n,questionnaireId:s,questionType:i}=e;return null===n||void 0===n||null===(t=n.find((e=>e.id===s)))||void 0===t||null===(o=t.questions.filter((e=>e.public_answers)).find((e=>e.type===i)))||void 0===o?void 0:o.id}},738:function(e,t,o){"use strict";var n=o(1),s=o.n(n),i=o(362),r=o(52),c=o(273),l=o(92),a=o(34),d=o(268),u=o(29),b=o(3);const m=e=>{let{data:t,textareaPlaceholder:o,withStarsRating:s,handleSubmit:i}=e;const{t:r}=Object(d.a)(),{title:c,description:l}=t,[a,m]=Object(n.useState)({rate:0,note:""});return Object(b.jsx)("form",{onSubmit:()=>{i(a.rate,a.note),m({rate:0,note:""})},children:s?Object(b.jsx)(u.Rate,{onSubmit:e=>m((t=>({...t,rate:e}))),header:t.title,children:Object(b.jsx)(u.TextArea,{placeholder:o,style:{marginTop:"30px"},value:a.note,onChange:e=>{let{target:{value:t}}=e;return m((e=>({...e,note:t})))}})}):Object(b.jsxs)(u.Stack,{$gap:30,children:[Object(b.jsx)(u.Title,{children:c}),Object(b.jsx)(u.Text,{children:l}),Object(b.jsx)(u.TextArea,{placeholder:o,value:a.note,onChange:e=>{let{target:{value:t}}=e;return m((e=>({...e,note:t})))}}),Object(b.jsx)(u.Button,{type:"submit",mode:"primary",style:{width:"fit-content",alignSelf:"center"},children:a.note.length?r("RateCourse.SendAnswer"):r("RateCourse.NoAnswer")})]})})};var j=o(684);t.a=e=>{var t;let{course:o,courseId:u,visible:p,questionnaire:v,onClose:h}=e;const{sendQuestionnaireAnswer:x}=Object(n.useContext)(r.EscolaLMSContext),{t:g}=Object(d.a)(),[O,f]=Object(n.useState)({loading:!1,step:0,showLastScreen:!1}),C=Object(n.useCallback)((async(e,t)=>{if(v.questions){f((e=>({...e,loading:!0})));try{(await x(o,u,v.id,{question_id:v.questions[O.step].id,rate:e,note:t,visible_on_front:v.questions[O.step].public_answers})).success&&c.b.success(g("RateCourse.ThankYouMessage"))}catch(n){c.b.error("Error"),console.error(n)}finally{f((e=>({...e,loading:!1,step:e.step+1,note:"",rating:null})))}}}),[o,u,v.id,O]),T=Object(n.useCallback)(((e,t)=>{C(e,t),v.questions&&O.step===v.questions.length-1&&f((e=>({...e,showLastScreen:!0})))}),[v,O.step,C]);return Object(b.jsx)(i.Modal,{onClose:h,visible:p,animation:"zoom",maskAnimation:"fade",destroyOnClose:!0,width:468,children:O.showLastScreen?Object(b.jsxs)(s.a.Fragment,{children:[Object(b.jsx)(l.Title,{level:4,className:"modal-title",style:{paddingTop:"50px"},children:g("RateCourse.ThankYou")}),Object(b.jsx)(a.Text,{style:{paddingBottom:"50px",textAlign:"center"},children:g("RateCourse.ThankYouMessage")})]}):v.questions&&Object(b.jsx)(m,{textareaPlaceholder:g("RateCourse.OptionalComment"),data:v.questions[O.step],handleSubmit:(e,t)=>T(e,t),withStarsRating:(null===(t=v.questions[O.step])||void 0===t?void 0:t.type)===j.a.REVIEW})})}}}]);
//# sourceMappingURL=40.3cbb0332.chunk.js.map